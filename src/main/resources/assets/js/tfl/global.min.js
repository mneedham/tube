/* appendAround markup pattern. [c]2012, @scottjehl, Filament Group, Inc. MIT/GPL
how-to:
	1. Insert potential element containers throughout the DOM
	2. give each container a data-set attribute with a value that matches all other containers' values
	3. Place your appendAround content in one of the potential containers
	4. Call appendAround() on that element when the DOM is ready
*/
(function(a){a.fn.appendAround=function(){return this.each(function(){var b=a(this),e="data-set",c=a("["+e+"='"+b.closest("["+e+"]").attr(e)+"']");function d(){if(b.is(":hidden")){b.appendTo(c.filter(":visible:eq(0)"))}a(window).trigger("append-around-complete")}d();a(window).on("changeBreakpoint",d)})}}(jQuery));(function(a){var c=0;var b=null;var d=null;a.fn.resetBreakpoints=function(){a(window).unbind("resize");c=0};a.fn.setBreakpoints=function(f){var e=jQuery.extend({distinct:true,useInnerWidth:true,breakpoints:[{name:"Small",resolution:10},{name:"Medium",resolution:580},{name:"Large",resolution:900}]},f);d=e.breakpoints.sort(function(g,h){return(h.resolution-g.resolution)});a(window).on("resize",function(){var l;if("innerWidth" in window){l=window.innerWidth}else{l=a(window).width()}var k=false;var h=false;for(var g in d){var j=e.breakpoints[g].resolution;if(!k&&l>=j&&c<j){if(e.distinct){for(var m in d){if(a("body").hasClass("breakpoint-"+e.breakpoints[m].name)){a("body").removeClass("breakpoint-"+e.breakpoints[m].name);a(window).trigger("exitBreakpoint"+e.breakpoints[m].name)}}k=true}a("body").addClass("breakpoint-"+e.breakpoints[g].name);a(window).trigger("enterBreakpoint"+e.breakpoints[g].name);h=true}if(l<e.breakpoints[g].resolution&&c>=e.breakpoints[g].resolution){a("body").removeClass("breakpoint-"+e.breakpoints[g].name);a(window).trigger("exitBreakpoint"+e.breakpoints[g].name);h=true}if(e.distinct&&l>=e.breakpoints[g].resolution&&l<e.breakpoints[g-1].resolution&&c>l&&c>0&&!a("body").hasClass("breakpoint-"+e.breakpoints[g].name)){a("body").addClass("breakpoint-"+e.breakpoints[g].name);a(window).trigger("enterBreakpoint"+e.breakpoints[g].name);h=true}}if(h){a(window).trigger("changeBreakpoint")}if(c!=l){c=l}});a(window).resize()}})(jQuery);
/* jQuery UI - v1.10.1 - 2013-02-15
* http://jqueryui.com
* Includes: jquery.ui.core.js
* Copyright 2013 jQuery Foundation and other contributors; Licensed MIT */
(function(a,g){function b(l,h){var k,e,j,m=l.nodeName.toLowerCase();return"area"===m?(k=l.parentNode,e=k.name,!l.href||!e||k.nodeName.toLowerCase()!=="map"?!1:(j=a("img[usemap=#"+e+"]")[0],!!j&&f(j))):(/input|select|textarea|button|object/.test(m)?!l.disabled:"a"===m?l.href||h:h)&&f(l)}function f(e){return a.expr.filters.visible(e)&&!a(e).parents().addBack().filter(function(){return a.css(this,"visibility")==="hidden"}).length}var c=0,d=/^ui-id-\d+$/;a.ui=a.ui||{};if(a.ui.version){return}a.extend(a.ui,{version:"1.10.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({_focus:a.fn.focus,focus:function(h,e){return typeof h=="number"?this.each(function(){var j=this;setTimeout(function(){a(j).focus(),e&&e.call(j)},h)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?e=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):e=this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!e.length?a(document):e},zIndex:function(h){if(h!==g){return this.css("zIndex",h)}if(this.length){var j=a(this[0]),e,k;while(j.length&&j[0]!==document){e=j.css("position");if(e==="absolute"||e==="relative"||e==="fixed"){k=parseInt(j.css("zIndex"),10);if(!isNaN(k)&&k!==0){return k}}j=j.parent()}}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++c)})},removeUniqueId:function(){return this.each(function(){d.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(e){return function(h){return !!a.data(h,e)}}):function(j,e,h){return !!a.data(j,h[3])},focusable:function(e){return b(e,!isNaN(a.attr(e,"tabindex")))},tabbable:function(j){var e=a.attr(j,"tabindex"),h=isNaN(e);return(h||e>=0)&&b(j,!h)}}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(h,k){function m(u,o,p,q){return a.each(e,function(){o-=parseFloat(a.css(u,"padding"+this))||0,p&&(o-=parseFloat(a.css(u,"border"+this+"Width"))||0),q&&(o-=parseFloat(a.css(u,"margin"+this))||0)}),o}var e=k==="Width"?["Left","Right"]:["Top","Bottom"],l=k.toLowerCase(),j={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+k]=function(o){return o===g?j["inner"+k].call(this):this.each(function(){a(this).css(l,m(this,o)+"px")})},a.fn["outer"+k]=function(p,o){return typeof p!="number"?j["outer"+k].call(this,p):this.each(function(){a(this).css(l,m(this,p,!0,o)+"px")})}}),a.fn.addBack||(a.fn.addBack=function(h){return this.add(h==null?this.prevObject:this.prevObject.filter(h))}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(e){return function(h){return arguments.length?e.call(this,a.camelCase(h)):e.call(this)}}(a.fn.removeData)),a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),a.support.selectstart="onselectstart" in document.createElement("div"),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(h){h.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(l,h,j){var e,k=a.ui[l].prototype;for(e in j){k.plugins[e]=k.plugins[e]||[],k.plugins[e].push([h,j[e]])}},call:function(h,m,k){var l,j=h.plugins[m];if(!j||!h.element[0].parentNode||h.element[0].parentNode.nodeType===11){return}for(l=0;l<j.length;l++){h.options[j[l][0]]&&j[l][1].apply(h.element,k)}}},hasScroll:function(k,h){if(a(k).css("overflow")==="hidden"){return !1}var j=h&&h==="left"?"scrollLeft":"scrollTop",e=!1;return k[j]>0?!0:(k[j]=1,e=k[j]>0,k[j]=0,e)}})})(jQuery);
/*
 * jQuery Cookie Plugin v1.3
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2011, Klaus Hartl
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.opensource.org/licenses/GPL-2.0
 */
(function(a,d,g){var e=/\+/g;function f(h){return h}function c(h){return decodeURIComponent(h.replace(e," "))}var b=a.cookie=function(o,u,q){if(u!==g){q=a.extend({},b.defaults,q);if(u===null){q.expires=-1}if(typeof q.expires==="number"){var k=q.expires,s=q.expires=new Date();s.setDate(s.getDate()+k)}u=b.json?JSON.stringify(u):String(u);return(d.cookie=[encodeURIComponent(o),"=",b.raw?u:encodeURIComponent(u),q.expires?"; expires="+q.expires.toUTCString():"",q.path?"; path="+q.path:"",q.domain?"; domain="+q.domain:"",q.secure?"; secure":""].join(""))}var m=b.raw?f:c;var j=d.cookie.split("; ");for(var n=0,p=j.length;n<p;n++){var r=j[n].split("=");if(m(r.shift())===o){var h=m(r.join("="));return b.json?JSON.parse(h):h}}return null};b.defaults={};a.removeCookie=function(h,j){if(a.cookie(h)!==null){a.cookie(h,null,j);return true}return false}})(jQuery,document);(function(a){a.fn.pajinate=function(q){var f="current_page";var j="items_per_page";var n;var g={item_container_id:".content",items_per_page:10,nav_panel_id:".page_navigation",nav_info_id:".info_text",num_page_links_to_display:20,start_page:0,wrap_around:false,nav_label_first:"First",nav_label_prev:"Prev",nav_label_next:"Next",nav_label_last:"Last",nav_order:["first","prev","num","next","last"],nav_label_info:"Showing {0}-{1} of {2} results",show_first_last:true,abort_on_small_lists:false,jquery_ui:false,jquery_ui_active:"ui-state-highlight",jquery_ui_default:"ui-state-default",jquery_ui_disabled:"ui-state-disabled"};var q=a.extend(g,q);var b;var e;var c;var d;var v;var l=q.jquery_ui?q.jquery_ui_default:"";var k=q.jquery_ui?q.jquery_ui_active:"";var m=q.jquery_ui?q.jquery_ui_disabled:"";return this.each(function(){e=a(this);b=a(this).find(q.item_container_id);c=e.find(q.item_container_id).children();if(q.abort_on_small_lists&&q.items_per_page>=c.size()){return e}n=e;n.data(f,0);n.data(j,q.items_per_page);var F=b.children().size();var E=Math.ceil(F/q.items_per_page);var C='<span class="ellipse more">...</span>';var B='<span class="ellipse less">...</span>';var y=!q.show_first_last?"":'<a class="first_link '+l+'" href="">'+q.nav_label_first+"</a>";var A=!q.show_first_last?"":'<a class="last_link '+l+'" href="">'+q.nav_label_last+"</a>";var D="";for(var z=0;z<q.nav_order.length;z++){switch(q.nav_order[z]){case"first":D+=y;break;case"last":D+=A;break;case"next":D+='<a id="next-link" class="next_link hide-text '+l+'" href="">'+q.nav_label_next+"</a>";break;case"prev":D+='<a id="prev-link" class="previous_link hide-text '+l+'" href="">'+q.nav_label_prev+"</a>";break;case"num":D+=B;var w=0;while(E>w){D+='<a class="page_link '+l+'" href="" data-longdesc="'+w+'">'+(w+1)+"</a>";w++}D+=C;break;default:break}}d=e.find(q.nav_panel_id);d.html(D).each(function(){a(this).find(".page_link:first").addClass("first");a(this).find(".page_link:last").addClass("last")});d.children(".ellipse").hide();d.find(".previous_link").next().next().addClass("active_page "+k);c.hide();c.slice(0,n.data(j)).show();v=e.find(q.nav_panel_id+":first").children(".page_link").size();q.num_page_links_to_display=Math.min(q.num_page_links_to_display,v);d.children(".page_link").hide();d.each(function(){a(this).children(".page_link").slice(0,q.num_page_links_to_display).show()});e.find(".first_link").click(function(G){G.preventDefault();p(a(this),0);h(0)});e.find(".last_link").click(function(G){G.preventDefault();var H=v-1;o(a(this),H);h(H)});e.find(".previous_link").click(function(G){G.preventDefault();s(a(this))});e.find(".next_link").click(function(G){G.preventDefault();r(a(this))});e.find(".page_link").click(function(G){G.preventDefault();h(a(this).attr("data-longdesc"))});h(parseInt(q.start_page));u();if(!q.wrap_around){t()}});function s(w){new_page=parseInt(n.data(f))-1;if(a(w).siblings(".active_page").prev(".page_link").length==true){p(w,new_page);h(new_page)}else{if(q.wrap_around){h(v-1)}}}function r(w){new_page=parseInt(n.data(f))+1;if(a(w).siblings(".active_page").next(".page_link").length==true){o(w,new_page);h(new_page)}else{if(q.wrap_around){h(0)}}}function h(B){B=parseInt(B,10);var z=parseInt(n.data(j));start_from=B*z;end_on=start_from+z;var A=c.hide().slice(start_from,end_on);A.show();e.find(q.nav_panel_id).children(".page_link[data-longdesc="+B+"]").addClass("active_page "+k).siblings(".active_page").removeClass("active_page "+k);n.data(f,B);var w=parseInt(n.data(f)+1);var C=b.children().size();var y=Math.ceil(C/q.items_per_page);e.find(q.nav_info_id).html(q.nav_label_info.replace("{0}",start_from+1).replace("{1}",start_from+A.length).replace("{2}",c.length).replace("{3}",w).replace("{4}",y));u();t();if(typeof(q.onPageDisplayed)!=="undefined"){q.onPageDisplayed.call(this,B+1)}}function o(y,z){var A=z;var w=a(y).siblings(".active_page");if(w.siblings(".page_link[data-longdesc="+A+"]").css("display")=="none"){d.each(function(){a(this).children(".page_link").hide().slice(parseInt(A-q.num_page_links_to_display+1),A+1).show()})}}function p(y,z){var A=z;var w=a(y).siblings(".active_page");if(w.siblings(".page_link[data-longdesc="+A+"]").css("display")=="none"){d.each(function(){a(this).children(".page_link").hide().slice(A,A+parseInt(q.num_page_links_to_display)).show()})}}function u(){if(!d.children(".page_link:visible").hasClass("last")){d.children(".more").show()}else{d.children(".more").hide()}if(!d.children(".page_link:visible").hasClass("first")){d.children(".less").show()}else{d.children(".less").hide()}}function t(){if(d.children(".last").hasClass("active_page")){d.children(".next_link").add(".last_link").addClass("no_more "+m)}else{d.children(".next_link").add(".last_link").removeClass("no_more "+m)}if(d.children(".first").hasClass("active_page")){d.children(".previous_link").add(".first_link").addClass("no_more "+m)}else{d.children(".previous_link").add(".first_link").removeClass("no_more "+m)}}}})(jQuery);(function(a){a.fn.clearSearch=function(b){var c=a.extend({clearClass:"clear_input",divClass:this.clearClass+"_div",focusAfterClear:true,linkText:"&times;",distanceFromEdge:5},b);return this.each(function(){var d=a(this),e;if(!d.parent().hasClass(c.divClass)){d.wrap('<div style="position: relative;" class="'+c.divClass+'">'+d.html()+"</div>");d.after('<a href="javascript:void(0)" style="position: absolute; cursor: pointer;" class="'+c.clearClass+'">'+c.linkText+"</a>")}e=d.next();function f(){d.val("").change();h();if(c.focusAfterClear){d.focus()}if(typeof(c.callback)==="function"){c.callback()}}function h(){if(g()){e.show()}else{e.hide()}j()}function g(){return d.val().replace(/^\s+|\s+$/g,"").length>0}function j(){var k=d.outerHeight();e.css({top:k/2-e.height()/2,right:c.distanceFromEdge})}e.on("click",f);d.on("keyup keydown change focus",h);h()})}})(jQuery);var Hogan={};(function(c,m){c.Template=function(p,q,n,o){this.r=p||this.r;this.c=n;this.options=o;this.text=q||"";this.buf=(m)?[]:""};c.Template.prototype={r:function(n,p,o){return""},v:d,t:a,render:function h(n,p,o){return this.ri([n],p||{},o)},ri:function(n,p,o){return this.r(n,p,o)},rp:function(p,n,r,o){var q=r[p];if(!q){return""}if(this.c&&typeof q=="string"){q=this.c.compile(q,this.options)}return q.ri(n,r,o)},rs:function(n,p,q){var r=n[n.length-1];if(!e(r)){q(n,p,this);return}for(var o=0;o<r.length;o++){n.push(r[o]);q(n,p,this);n.pop()}},s:function(u,n,q,p,s,o,t){var r;if(e(u)&&u.length===0){return false}if(typeof u=="function"){u=this.ls(u,n,q,p,s,o,t)}r=(u==="")||!!u;if(!p&&r&&n){n.push((typeof u=="object")?u:n[n.length-1])}return r},d:function(q,n,s,t){var r=q.split("."),u=this.f(r[0],n,s,t),o=null;if(q==="."&&e(n[n.length-2])){return n[n.length-1]}for(var p=1;p<r.length;p++){if(u&&typeof u=="object"&&r[p] in u){o=u;u=u[r[p]]}else{u=""}}if(t&&!u){return false}if(!t&&typeof u=="function"){n.push(o);u=this.lv(u,n,s);n.pop()}return u},f:function(q,n,r,s){var u=false,t=null,o=false;for(var p=n.length-1;p>=0;p--){t=n[p];if(t&&typeof t=="object"&&q in t){u=t[q];o=true;break}}if(!o){return(s)?false:""}if(!s&&typeof u=="function"){u=this.lv(u,n,r)}return u},ho:function(t,o,q,s,r){var n=this.c;var p=this.options;p.delimiters=r;var s=t.call(o,s);s=(s==null)?String(s):s.toString();this.b(n.compile(s,p).render(o,q));return false},b:(m)?function(n){this.buf.push(n)}:function(n){this.buf+=n},fl:(m)?function(){var n=this.buf.join("");this.buf=[];return n}:function(){var n=this.buf;this.buf="";return n},ls:function(w,n,r,q,s,p,v){var o=n[n.length-1],u=null;if(!q&&this.c&&w.length>0){return this.ho(w,o,r,this.text.substring(s,p),v)}u=w.call(o);if(typeof u=="function"){if(q){return true}else{if(this.c){return this.ho(u,o,r,this.text.substring(s,p),v)}}}return u},lv:function(r,n,p){var o=n[n.length-1];var q=r.call(o);if(typeof q=="function"){q=a(q.call(o));if(this.c&&~q.indexOf("{\u007B")){return this.c.compile(q,this.options).render(o,p)}}return a(q)}};var f=/&/g,k=/</g,j=/>/g,g=/\'/g,l=/\"/g,b=/[&<>\"\']/;function a(n){return String((n===null||n===undefined)?"":n)}function d(n){n=a(n);return b.test(n)?n.replace(f,"&amp;").replace(k,"&lt;").replace(j,"&gt;").replace(g,"&#39;").replace(l,"&quot;"):n}var e=Array.isArray||function(n){return Object.prototype.toString.call(n)==="[object Array]"}})(typeof exports!=="undefined"?exports:Hogan);(function(e){var l=/\S/,n=/\"/g,m=/\n/g,k=/\r/g,o=/\\/g,s={"#":1,"^":2,"/":3,"!":4,">":5,"<":6,"=":7,_v:8,"{":9,"&":10};e.scan=function p(R,D){var J=R.length,I=0,H=1,G=2,O=I,Q=null,P=null,A="",S=[],N=false,F=0,L=0,M="{{",C="}}";function z(){if(A.length>0){S.push(new String(A));A=""}}function K(){var T=true;for(var U=L;U<S.length;U++){T=(S[U].tag&&s[S[U].tag]<s._v)||(!S[U].tag&&S[U].match(l)===null);if(!T){return false}}return T}function E(T,W){z();if(T&&K()){for(var U=L,V;U<S.length;U++){if(!S[U].tag){if((V=S[U+1])&&V.tag==">"){V.indent=S[U].toString()}S.splice(U,1)}}}else{if(!W){S.push({tag:"\n"})}}N=false;L=S.length}function B(X,W){var T="="+C,U=X.indexOf(T,W),V=u(X.substring(X.indexOf("=",W)+1,U)).split(" ");M=V[0];C=V[1];return U+T.length-1}if(D){D=D.split(" ");M=D[0];C=D[1]}for(F=0;F<J;F++){if(O==I){if(r(M,R,F)){--F;z();O=H}else{if(R.charAt(F)=="\n"){E(N)}else{A+=R.charAt(F)}}}else{if(O==H){F+=M.length-1;P=s[R.charAt(F+1)];Q=P?R.charAt(F+1):"_v";if(Q=="="){F=B(R,F);O=I}else{if(P){F++}O=G}N=F}else{if(r(C,R,F)){S.push({tag:Q,n:u(A),otag:M,ctag:C,i:(Q=="/")?N-C.length:F+M.length});A="";F+=C.length-1;O=I;if(Q=="{"){if(C=="}}"){F++}else{c(S[S.length-1])}}}else{A+=R.charAt(F)}}}}E(N,true);return S};function c(z){if(z.n.substr(z.n.length-1)==="}"){z.n=z.n.substring(0,z.n.length-1)}}function u(z){if(z.trim){return z.trim()}return z.replace(/^\s*|\s*$/g,"")}function r(C,D,A){if(D.charAt(A)!=C.charAt(0)){return false}for(var z=1,B=C.length;z<B;z++){if(D.charAt(A+z)!=C.charAt(z)){return false}}return true}function a(F,B,D,z){var A=[],C=null,E=null;while(F.length>0){E=F.shift();if(E.tag=="#"||E.tag=="^"||h(E,z)){D.push(E);E.nodes=a(F,E.tag,D,z);A.push(E)}else{if(E.tag=="/"){if(D.length===0){throw new Error("Closing tag without opener: /"+E.n)}C=D.pop();if(E.n!=C.n&&!g(E.n,C.n,z)){throw new Error("Nesting error: "+C.n+" vs. "+E.n)}C.end=E.i;return A}else{A.push(E)}}}if(D.length>0){throw new Error("missing closing tag: "+D.pop().n)}return A}function h(C,B){for(var z=0,A=B.length;z<A;z++){if(B[z].o==C.n){C.tag="#";return true}}}function g(z,C,D){for(var A=0,B=D.length;A<B;A++){if(D[A].c==z&&D[A].o==C){return true}}}e.generate=function(C,B,A){var z='var _=this;_.b(i=i||"");'+y(C)+"return _.fl();";if(A.asString){return"function(c,p,i){"+z+";}"}return new e.Template(new Function("c","p","i",z),B,e,A)};function d(z){return z.replace(o,"\\\\").replace(n,'\\"').replace(m,"\\n").replace(k,"\\r")}function b(z){return(~z.indexOf("."))?"d":"f"}function y(D){var z="";for(var A=0,B=D.length;A<B;A++){var C=D[A].tag;if(C=="#"){z+=q(D[A].nodes,D[A].n,b(D[A].n),D[A].i,D[A].end,D[A].otag+" "+D[A].ctag)}else{if(C=="^"){z+=f(D[A].nodes,D[A].n,b(D[A].n))}else{if(C=="<"||C==">"){z+=j(D[A])}else{if(C=="{"||C=="&"){z+=v(D[A].n,b(D[A].n))}else{if(C=="\n"){z+=t('"\\n"'+(D.length-1==A?"":" + i"))}else{if(C=="_v"){z+=w(D[A].n,b(D[A].n))}else{if(C===undefined){z+=t('"'+d(D[A])+'"')}}}}}}}}return z}function q(C,A,B,D,z,E){return"if(_.s(_."+B+'("'+d(A)+'",c,p,1),c,p,0,'+D+","+z+',"'+E+'")){_.rs(c,p,function(c,p,_){'+y(C)+"});c.pop();}"}function f(B,z,A){return"if(!_.s(_."+A+'("'+d(z)+'",c,p,1),c,p,1,0,0,"")){'+y(B)+"};"}function j(z){return'_.b(_.rp("'+d(z.n)+'",c,p,"'+(z.indent||"")+'"));'}function v(z,A){return"_.b(_.t(_."+A+'("'+d(z)+'",c,p,0)));'}function w(z,A){return"_.b(_.v(_."+A+'("'+d(z)+'",c,p,0)));'}function t(z){return"_.b("+z+");"}e.parse=function(B,A,z){z=z||{};return a(B,"",[],z.sectionTags||[])},e.cache={};e.compile=function(C,A){A=A||{};var z=C+"||"+!!A.asString;var B=this.cache[z];if(B){return B}B=this.generate(this.parse(this.scan(C,A.delimiters),C,A),C,A);return this.cache[z]=B}})(typeof exports!=="undefined"?exports:Hogan);
/*
 * typeahead.js 0.9.3
 * https://github.com/twitter/typeahead
 * Copyright 2013 Twitter, Inc. and other contributors; Licensed MIT
 */
(function(a){var m="0.9.3";var l={isMsie:function(){var n=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return n?parseInt(n[2],10):false},isBlankString:function(n){return !n||/^\s*$/.test(n)},escapeRegExChars:function(n){return n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(n){return typeof n==="string"},isNumber:function(n){return typeof n==="number"},isArray:a.isArray,isFunction:a.isFunction,isObject:a.isPlainObject,isUndefined:function(n){return typeof n==="undefined"},bind:a.proxy,bindAll:function(o){var p;for(var n in o){a.isFunction(p=o[n])&&(o[n]=a.proxy(p,o))}},indexOf:function(n,p){for(var o=0;o<n.length;o++){if(n[o]===p){return o}}return -1},each:a.each,map:a.map,filter:a.grep,every:function(n,p){var o=true;if(!n){return o}a.each(n,function(q,r){if(!(o=p.call(null,r,q,n))){return false}});return !!o},some:function(n,p){var o=false;if(!n){return o}a.each(n,function(q,r){if(o=p.call(null,r,q,n)){return false}});return !!o},mixin:a.extend,getUniqueId:function(){var n=0;return function(){return n++}}(),defer:function(n){setTimeout(n,0)},debounce:function(n,r,o){var q,p;return function(){var u=this,s=arguments,v,t;v=function(){q=null;if(!o){p=n.apply(u,s)}};t=o&&!q;clearTimeout(q);q=setTimeout(v,r);if(t){p=n.apply(u,s)}return p}},throttle:function(p,u){var o,n,t,s,r,q;r=0;q=function(){r=new Date();t=null;s=p.apply(o,n)};return function(){var v=new Date(),w=u-(v-r);o=this;n=arguments;if(w<=0){clearTimeout(t);t=null;r=v;s=p.apply(o,n)}else{if(!t){t=setTimeout(q,w)}}return s}},tokenizeQuery:function(n){return a.trim(n).toLowerCase().split(/[\s]+/)},tokenizeText:function(n){return a.trim(n).toLowerCase().split(/[\s\-_]+/)},getProtocol:function(){return location.protocol},noop:function(){}};var e=function(){var n=/\s+/;return{on:function(q,o){var p;if(!o){return this}this._callbacks=this._callbacks||{};q=q.split(n);while(p=q.shift()){this._callbacks[p]=this._callbacks[p]||[];this._callbacks[p].push(o)}return this},trigger:function(r,p){var q,o;if(!this._callbacks){return this}r=r.split(n);while(q=r.shift()){if(o=this._callbacks[q]){for(var s=0;s<o.length;s+=1){o[s].call(this,{type:q,data:p})}}}return this}}}();var d=function(){var o="typeahead:";function n(p){if(!p||!p.el){a.error("EventBus initialized without el")}this.$el=a(p.el)}l.mixin(n.prototype,{trigger:function(q){var p=[].slice.call(arguments,1);this.$el.trigger(o+q,p)}});return n}();var g=function(){var q,r;try{q=window.localStorage;q.setItem("~~~","!");q.removeItem("~~~")}catch(p){q=null}function t(u){this.prefix=["__",u,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+this.prefix)}if(q&&window.JSON){r={_prefix:function(u){return this.prefix+u},_ttlKey:function(u){return this._prefix(u)+this.ttlKey},get:function(u){if(this.isExpired(u)){this.remove(u)}return n(q.getItem(this._prefix(u)))},set:function(u,w,v){if(l.isNumber(v)){q.setItem(this._ttlKey(u),o(s()+v))}else{q.removeItem(this._ttlKey(u))}return q.setItem(this._prefix(u),o(w))},remove:function(u){q.removeItem(this._ttlKey(u));q.removeItem(this._prefix(u));return this},clear:function(){var u,v,w=[],y=q.length;for(u=0;u<y;u++){if((v=q.key(u)).match(this.keyMatcher)){w.push(v.replace(this.keyMatcher,""))}}for(u=w.length;u--;){this.remove(w[u])}return this},isExpired:function(u){var v=n(q.getItem(this._ttlKey(u)));return l.isNumber(v)&&s()>v?true:false}}}else{r={get:l.noop,set:l.noop,remove:l.noop,clear:l.noop,isExpired:l.noop}}l.mixin(t.prototype,r);return t;function s(){return new Date().getTime()}function o(u){return JSON.stringify(l.isUndefined(u)?null:u)}function n(u){return JSON.parse(u)}}();var h=function(){function n(p){l.bindAll(this);p=p||{};this.sizeLimit=p.sizeLimit||10;this.cache={};this.cachedKeysByAge=[]}l.mixin(n.prototype,{get:function(o){return this.cache[o]},set:function(q,p){var o;if(this.cachedKeysByAge.length===this.sizeLimit){o=this.cachedKeysByAge.shift();delete this.cache[o]}this.cache[q]=p;this.cachedKeysByAge.push(q)}});return n}();var j=function(){var s=0,r={},q,t;function u(v){l.bindAll(this);v=l.isString(v)?{url:v}:v;t=t||new h();q=l.isNumber(v.maxParallelRequests)?v.maxParallelRequests:q||6;this.url=v.url;this.wildcard=v.wildcard||"%QUERY";this.filter=v.filter;this.replace=v.replace;this.ajaxSettings={type:"get",cache:v.cache,timeout:v.timeout,dataType:v.dataType||"json",beforeSend:v.beforeSend};this._get=(/^throttle$/i.test(v.rateLimitFn)?l.throttle:l.debounce)(this._get,v.rateLimitWait||300)}l.mixin(u.prototype,{_get:function(z,v){var y=this;if(n()){this._sendRequest(z).done(w)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}function w(B){var A=y.filter?y.filter(B):B;v&&v(A);t.set(z,B)}},_sendRequest:function(z){var y=this,w=r[z];if(!w){p();w=r[z]=a.ajax(z,this.ajaxSettings).always(v)}return w;function v(){o();r[z]=null;if(y.onDeckRequestArgs){y._get.apply(y,y.onDeckRequestArgs);y.onDeckRequestArgs=null}}},get:function(y,v){var A=this,w=encodeURIComponent(y||""),B,z;v=v||l.noop;B=this.replace?this.replace(this.url,w):this.url.replace(this.wildcard,w);if(z=t.get(B)){l.defer(function(){v(A.filter?A.filter(z):z)})}else{this._get(B,v)}return !!z}});return u;function p(){s++}function o(){s--}function n(){return s<q}}();var b=function(){var p={thumbprint:"thumbprint",protocol:"protocol",itemHash:"itemHash",adjacencyList:"adjacencyList"};function o(q){l.bindAll(this);if(l.isString(q.template)&&!q.engine){a.error("no template engine specified")}if(!q.local&&!q.prefetch&&!q.remote){a.error("one of local, prefetch, or remote is required")}this.name=q.name||l.getUniqueId();this.limit=q.limit||5;this.minLength=q.minLength===0?0:q.minLength||1;this.header=q.header;this.footer=q.footer;this.valueKey=q.valueKey||"value";this.template=n(q.template,q.engine,this.valueKey);this.local=q.local;this.prefetch=q.prefetch;this.remote=q.remote;this.itemHash={};this.adjacencyList={};this.storage=q.name?new g(q.name):null}l.mixin(o.prototype,{_processLocalData:function(q){this._mergeProcessedData(this._processData(q))},_loadPrefetchData:function(s){var z=this,A=m+(s.thumbprint||""),y,w,v,u,r,q;if(this.storage){y=this.storage.get(p.thumbprint);w=this.storage.get(p.protocol);v=this.storage.get(p.itemHash);u=this.storage.get(p.adjacencyList)}r=y!==A||w!==l.getProtocol();s=l.isString(s)?{url:s}:s;s.ttl=l.isNumber(s.ttl)?s.ttl:24*60*60*1000;if(v&&u&&!r){this._mergeProcessedData({itemHash:v,adjacencyList:u});q=a.Deferred().resolve()}else{q=a.getJSON(s.url).done(t)}return q;function t(C){var D=s.filter?s.filter(C):C,F=z._processData(D),E=F.itemHash,B=F.adjacencyList;if(z.storage){z.storage.set(p.itemHash,E,s.ttl);z.storage.set(p.adjacencyList,B,s.ttl);z.storage.set(p.thumbprint,A,s.ttl);z.storage.set(p.protocol,l.getProtocol(),s.ttl)}z._mergeProcessedData(F)}},_transformDatum:function(q){var t=l.isString(q)?q:q[this.valueKey],s=q.tokens||l.tokenizeText(t),r={value:t,tokens:s};if(l.isString(q)){r.datum={};r.datum[this.valueKey]=q}else{r.datum=q}r.tokens=l.filter(r.tokens,function(u){return !l.isBlankString(u)});r.tokens=l.map(r.tokens,function(u){return u.toLowerCase()});return r},_processData:function(r){var t=this,s={},q={};l.each(r,function(v,u){var y=t._transformDatum(u),w=l.getUniqueId(y.value);s[w]=y;l.each(y.tokens,function(B,C){var A=C.charAt(0),z=q[A]||(q[A]=[w]);!~l.indexOf(z,w)&&z.push(w)})});return{itemHash:s,adjacencyList:q}},_mergeProcessedData:function(q){var r=this;l.mixin(this.itemHash,q.itemHash);l.each(q.adjacencyList,function(t,s){var u=r.adjacencyList[t];r.adjacencyList[t]=u?u.concat(s):s})},_getLocalSuggestions:function(u){var v=this,q=[],r=[],s,t=[];l.each(u,function(y,z){var w=z.charAt(0);!~l.indexOf(q,w)&&q.push(w)});l.each(q,function(y,w){var z=v.adjacencyList[w];if(!z){return false}r.push(z);if(!s||z.length<s.length){s=z}});if(r.length<q.length){return[]}l.each(s,function(w,y){var B=v.itemHash[y],z,A;z=l.every(r,function(C){return ~l.indexOf(C,y)});A=z&&l.every(u,function(C){return l.some(B.tokens,function(D){return D.indexOf(C)===0})});A&&t.push(B)});return t},initialize:function(){var q;this.local&&this._processLocalData(this.local);this.transport=this.remote?new j(this.remote):null;q=this.prefetch?this._loadPrefetchData(this.prefetch):a.Deferred().resolve();this.local=this.prefetch=this.remote=null;this.initialize=function(){return q};return q},getSuggestions:function(t,r){var w=this,v,u,q=false;if(t.length<this.minLength){return}v=l.tokenizeQuery(t);u=this._getLocalSuggestions(v).slice(0,this.limit);if(u.length<this.limit&&this.transport){q=this.transport.get(t,s)}!q&&r&&r(u);function s(y){u=u.slice(0);l.each(y,function(A,z){var C=w._transformDatum(z),B;B=l.some(u,function(D){return C.value===D.value});!B&&u.push(C);return u.length<w.limit});r&&r(u)}}});return o;function n(t,r,u){var s,q;if(l.isFunction(t)){s=t}else{if(l.isString(t)){q=r.compile(t);s=l.bind(q.render,q)}else{s=function(v){return"<p>"+v[u]+"</p>"}}}return s}}();var f=function(){function p(q){var r=this;l.bindAll(this);this.specialKeyCodeMap={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};this.$hint=a(q.hint);this.$input=a(q.input).on("blur.tt",this._handleBlur).on("focus.tt",this._handleFocus).on("keydown.tt",this._handleSpecialKeyEvent);if(!l.isMsie()){this.$input.on("input.tt",this._compareQueryToInputValue)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(s){if(r.specialKeyCodeMap[s.which||s.keyCode]){return}l.defer(r._compareQueryToInputValue)})}this.query=this.$input.val();this.$overflowHelper=n(this.$input)}l.mixin(p.prototype,e,{_handleFocus:function(){this.trigger("focused")},_handleBlur:function(){this.trigger("blured")},_handleSpecialKeyEvent:function(q){var r=this.specialKeyCodeMap[q.which||q.keyCode];r&&this.trigger(r+"Keyed",q)},_compareQueryToInputValue:function(){var q=this.getInputValue(),r=o(this.query,q),s=r?this.query.length!==q.length:false;if(s){this.trigger("whitespaceChanged",{value:this.query})}else{if(!r){this.trigger("queryChanged",{value:this.query=q})}}},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},setQuery:function(q){this.query=q},getInputValue:function(){return this.$input.val()},setInputValue:function(r,q){this.$input.val(r);!q&&this._compareQueryToInputValue()},getHintValue:function(){return this.$hint.val()},setHintValue:function(q){this.$hint.val(q)},hidePlaceholder:function(){if(!this.placeholderText){this.placeholderText=this.$input.attr("placeholder")}this.$input.attr("placeholder","")},showPlaceholder:function(){if(this.placeholderText){this.$input.attr("placeholder",this.placeholderText)}},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},isOverflow:function(){this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>this.$input.width()},isCursorAtEnd:function(){var s=this.$input.val().length,r=this.$input[0].selectionStart,q;if(l.isNumber(r)){return r===s}else{if(document.selection){q=document.selection.createRange();q.moveStart("character",-s);return s===q.text.length}}return true},isCursorAtBeginning:function(){var s=this.$input.val().length,r=this.$input[0].selectionStart,q;if(l.isNumber(r)){return r===0}else{if(document.selection){q=document.selection.createRange();q.moveStart("character",-s);return q.text.length===0}}return true}});return p;function n(q){return a("<span></span>").css({position:"absolute",left:"-9999px",visibility:"hidden",whiteSpace:"nowrap",fontFamily:q.css("font-family"),fontSize:q.css("font-size"),fontStyle:q.css("font-style"),fontVariant:q.css("font-variant"),fontWeight:q.css("font-weight"),wordSpacing:q.css("word-spacing"),letterSpacing:q.css("letter-spacing"),textIndent:q.css("text-indent"),textRendering:q.css("text-rendering"),textTransform:q.css("text-transform")}).insertAfter(q)}function o(q,r){q=(q||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");r=(r||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ");return q===r}}();var c=function(){var q={suggestionsList:'<span class="tt-suggestions"></span>'},n={suggestionsList:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"}};function o(r){l.bindAll(this);this.isOpen=false;this.isEmpty=true;this.isMouseOverDropdown=false;this.$menu=a(r.menu).on("mouseenter.tt",this._handleMouseenter).on("mouseleave.tt",this._handleMouseleave).on("click.tt",".tt-suggestion",this._handleSelection).on("mouseover.tt",".tt-suggestion",this._handleMouseover)}l.mixin(o.prototype,e,{_handleMouseenter:function(){this.isMouseOverDropdown=true},_handleMouseleave:function(){this.isMouseOverDropdown=false},_handleMouseover:function(r){var s=a(r.currentTarget);this._getSuggestions().removeClass("tt-is-under-cursor");s.addClass("tt-is-under-cursor")},_handleSelection:function(r){var s=a(r.currentTarget);this.trigger("suggestionSelected",p(s))},_show:function(){this.$menu.css("display","block")},_hide:function(){this.$menu.hide()},_moveCursor:function(u){var s,r,v,t;if(!this.isVisible()){return}s=this._getSuggestions();r=s.filter(".tt-is-under-cursor");r.removeClass("tt-is-under-cursor");v=s.index(r)+u;v=(v+1)%(s.length+1)-1;if(v===-1){this.trigger("cursorRemoved");return}else{if(v<-1){v=s.length-1}}t=s.eq(v).addClass("tt-is-under-cursor");this._ensureVisibility(t);this.trigger("cursorMoved",p(t))},_getSuggestions:function(){return this.$menu.find(".tt-suggestions > .tt-suggestion")},_ensureVisibility:function(r){var u=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10),v=this.$menu.scrollTop(),t=r.position().top,s=t+r.outerHeight(true);if(t<0){this.$menu.scrollTop(v+t)}else{if(u<s){this.$menu.scrollTop(v+(s-u))}}},destroy:function(){this.$menu.off(".tt");this.$menu=null},isVisible:function(){return this.isOpen&&!this.isEmpty},closeUnlessMouseIsOverDropdown:function(){if(!this.isMouseOverDropdown){this.close()}},close:function(){if(this.isOpen){this.isOpen=false;this.isMouseOverDropdown=false;this._hide();this.$menu.find(".tt-suggestions > .tt-suggestion").removeClass("tt-is-under-cursor");this.trigger("closed")}},open:function(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function(r){var s={left:"0",right:"auto"},t={left:"auto",right:" 0"};r==="ltr"?this.$menu.css(s):this.$menu.css(t)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(+1)},getSuggestionUnderCursor:function(){var r=this._getSuggestions().filter(".tt-is-under-cursor").first();return r.length>0?p(r):null},getFirstSuggestion:function(){var r=this._getSuggestions().first();return r.length>0?p(r):null},renderSuggestions:function(v,A){var w="tt-dataset-"+v.name,B='<div class="tt-suggestion">%body</div>',u,t,r=this.$menu.find("."+w),y,z,s;if(r.length===0){t=a(q.suggestionsList).css(n.suggestionsList);r=a("<div></div>").addClass(w).append(v.header).append(t).append(v.footer).appendTo(this.$menu)}if(A.length>0){this.isEmpty=false;this.isOpen&&this._show();y=document.createElement("div");z=document.createDocumentFragment();l.each(A,function(C,D){D.dataset=v.name;u=v.template(D.datum);y.innerHTML=B.replace("%body",u);s=a(y.firstChild).css(n.suggestion).data("suggestion",D);s.children().each(function(){a(this).css(n.suggestionChild)});z.appendChild(s[0])});r.show().find(".tt-suggestions").html(z)}else{this.clearSuggestions(v.name)}this.trigger("suggestionsRendered")},clearSuggestions:function(t){var r=t?this.$menu.find(".tt-dataset-"+t):this.$menu.find('[class^="tt-dataset-"]'),s=r.find(".tt-suggestions");r.hide();s.empty();if(this._getSuggestions().length===0){this.isEmpty=true;this._hide()}}});return o;function p(r){return r.data("suggestion")}}();var k=function(){var q={wrapper:'<span class="twitter-typeahead"></span>',hint:'<input class="tt-hint" type="text" autocomplete="off" aria-hidden="true" spellcheck="off" disabled>',dropdown:'<span class="tt-dropdown-menu"></span>'},o={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none"},query:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"}};if(l.isMsie()){l.mixin(o.query,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}if(l.isMsie()&&l.isMsie()<=7){l.mixin(o.wrapper,{display:"inline",zoom:"1"});l.mixin(o.query,{marginTop:"-1px"})}function r(v){var u,t,s;l.bindAll(this);this.$node=n(v.input);this.datasets=v.datasets;this.dir=null;this.eventBus=v.eventBus;u=this.$node.find(".tt-dropdown-menu");t=this.$node.find(".tt-query");s=this.$node.find(".tt-hint");this.dropdownView=new c({menu:u}).on("suggestionSelected",this._handleSelection).on("cursorMoved",this._clearHint).on("cursorMoved",this._setInputValueToSuggestionUnderCursor).on("cursorRemoved",this._setInputValueToQuery).on("cursorRemoved",this._updateHint).on("suggestionsRendered",this._updateHint).on("opened",this._updateHint).on("closed",this._clearHint).on("opened closed",this._propagateEvent);this.inputView=new f({input:t,hint:s}).on("focused",this._openDropdown).on("blured",this._closeDropdown).on("blured",this._setInputValueToQuery).on("enterKeyed tabKeyed",this._handleSelection).on("queryChanged",this._clearHint).on("queryChanged",this._clearSuggestions).on("queryChanged",this._getSuggestions).on("whitespaceChanged",this._updateHint).on("queryChanged whitespaceChanged",this._openDropdown).on("queryChanged whitespaceChanged",this._setLanguageDirection).on("escKeyed",this._closeDropdown).on("escKeyed",this._setInputValueToQuery).on("tabKeyed upKeyed downKeyed",this._managePreventDefault).on("upKeyed downKeyed",this._moveDropdownCursor).on("upKeyed downKeyed",this._openDropdown).on("tabKeyed leftKeyed rightKeyed",this._autocomplete).on("tabKeyed",this._closeDropdown)}l.mixin(r.prototype,e,{_managePreventDefault:function(t){var s=t.data,u,v,w=false;switch(t.type){case"tabKeyed":u=this.inputView.getHintValue();v=this.inputView.getInputValue();w=u&&u!==v&&v!=="";break;case"upKeyed":case"downKeyed":w=!s.shiftKey&&!s.ctrlKey&&!s.metaKey;break}w&&s.preventDefault()},_setLanguageDirection:function(){var s=this.inputView.getLanguageDirection();if(s!==this.dir){this.dir=s;this.$node.css("direction",s);this.dropdownView.setLanguageDirection(s)}},_updateHint:function(){var B=this.dropdownView.getFirstSuggestion(),v=B?B.value:null,t=this.dropdownView.isVisible(),w=this.inputView.isOverflow(),y,A,u,s,z;if(v&&t&&!w){y=this.inputView.getInputValue();A=y.replace(/\s{2,}/g," ").replace(/^\s+/g,"");u=l.escapeRegExChars(A);s=new RegExp("^(?:"+u+")(.*$)","i");z=s.exec(v);if(y===""){this.inputView.hidePlaceholder()}this.inputView.setHintValue(y+(z?z[1]:""))}},_clearHint:function(){this.inputView.showPlaceholder();this.inputView.setHintValue("")},_clearSuggestions:function(){this.dropdownView.clearSuggestions()},_setInputValueToQuery:function(){this.inputView.setInputValue(this.inputView.getQuery())},_setInputValueToSuggestionUnderCursor:function(s){var t=s.data;this.inputView.setInputValue(t.value,true)},_openDropdown:function(){if(!this.dropdownView.isOpen){this._getSuggestions()}this.dropdownView.open()},_closeDropdown:function(s){this.dropdownView[s.type==="blured"?"closeUnlessMouseIsOverDropdown":"close"]()},_moveDropdownCursor:function(t){var s=t.data;if(!s.shiftKey&&!s.ctrlKey&&!s.metaKey){this.dropdownView[t.type==="upKeyed"?"moveCursorUp":"moveCursorDown"]()}},_handleSelection:function(t){var s=t.type==="suggestionSelected",u=s?t.data:this.dropdownView.getSuggestionUnderCursor();if(u){this.inputView.setInputValue(u.value);s?this.inputView.focus():t.data.preventDefault();s&&l.isMsie()?l.defer(this.dropdownView.close):this.dropdownView.close();this.eventBus.trigger("selected",u.datum,u.dataset)}},_getSuggestions:function(){var u=this,t=this.inputView.getQuery(),s=l.isBlankString(t);l.each(this.datasets,function(w,v){if(!s){v.getSuggestions(t,function(A){if(t===u.inputView.getQuery()){u.dropdownView.renderSuggestions(v,A)}})}else{if(v.minLength===0){var z=[];var w=0;for(var y in v.itemHash){if(v.limit&&w>=v.limit){break}z.push(v.itemHash[y]);w++}u.dropdownView.renderSuggestions(v,z)}}})},_autocomplete:function(s){var w,v,y,u,z,t,A;if(s.type==="rightKeyed"||s.type==="leftKeyed"){w=this.inputView.isCursorAtEnd();u=this.inputView.getLanguageDirection()==="ltr"?s.type==="leftKeyed":s.type==="rightKeyed";if(!w||u){return}}if(s.type==="tabKeyed"){y=this.inputView.getLanguageDirection();if(y==="ltr"&&this.inputView.isCursorAtBeginning()||y!=="ltr"&&this.inputView.isCursorAtEnd()){return}}z=this.inputView.getQuery();t=this.inputView.getHintValue();if(t!==""&&z!==t){A=this.dropdownView.getFirstSuggestion();this.inputView.setInputValue(A.value);this.eventBus.trigger("autocompleted",A.datum,A.dataset)}},_propagateEvent:function(s){this.eventBus.trigger(s.type)},destroy:function(){this.inputView.destroy();this.dropdownView.destroy();p(this.$node);this.$node=null},setQuery:function(s){this.inputView.setQuery(s);this.inputView.setInputValue(s);this._clearHint();this._clearSuggestions();this._getSuggestions()}});return r;function n(y){var v=a(q.wrapper),s=a(q.dropdown),u=a(y),t=a(q.hint);v=v.css(o.wrapper);s=s.css(o.dropdown);t.css(o.hint).css({backgroundAttachment:u.css("background-attachment"),backgroundClip:u.css("background-clip"),backgroundColor:u.css("background-color"),backgroundImage:u.css("background-image"),backgroundOrigin:u.css("background-origin"),backgroundPosition:u.css("background-position"),backgroundRepeat:u.css("background-repeat"),backgroundSize:u.css("background-size")});u.data("ttAttrs",{dir:u.attr("dir"),autocomplete:u.attr("autocomplete"),spellcheck:u.attr("spellcheck"),style:u.attr("style")});u.addClass("tt-query").attr({autocomplete:"off",spellcheck:false}).css(o.query);try{!u.attr("dir")&&u.attr("dir","auto")}catch(w){}return u.wrap(v).parent().prepend(t).append(s)}function p(t){var s=t.find(".tt-query");l.each(s.data("ttAttrs"),function(u,v){l.isUndefined(v)?s.removeAttr(u):s.attr(u,v)});s.detach().removeData("ttAttrs").removeClass("tt-query").insertAfter(t);t.remove()}}();(function(){var n={},p="ttView",o;o={initialize:function(q){var r;q=l.isArray(q)?q:[q];if(q.length===0){a.error("no datasets provided")}r=l.map(q,function(u){var t=n[u.name]?n[u.name]:new b(u);if(u.name){n[u.name]=t}return t});return this.each(s);function s(){var t=a(this),u,v=new d({el:t});u=l.map(r,function(w){return w.initialize()});t.data(p,new k({input:t,eventBus:v=new d({el:t}),datasets:r}));a.when.apply(a,u).always(function(){l.defer(function(){v.trigger("initialized")})})}},destroy:function(){return this.each(q);function q(){var r=a(this),s=r.data(p);if(s){s.destroy();r.removeData(p)}}},setQuery:function(q){return this.each(r);function r(){var s=a(this).data(p);s&&s.setQuery(q)}}};jQuery.fn.typeahead=function(q){if(o[q]){return o[q].apply(this,[].slice.call(arguments,1))}else{return o.initialize.apply(this,arguments)}}})()})(window.jQuery);(function(a){tfl.logs.create("tfl.storage: loaded");var b=window.localStorage;a.isLocalStorageSupported=function(){if("localStorage" in window&&window.localStorage!==null){tfl.logs.create("tfl.storage: isLocalStorageSupported true");return true}else{tfl.logs.create("tfl.storage: isLocalStorageSupported false");return false}};a.set=function(d,g){if(b&&d!=undefined){try{var f=JSON.stringify(g);b.setItem(d,f);tfl.logs.create("tfl.storage.set: "+d+":"+f)}catch(c){tfl.logs.create("tfl.storage.set:"+c.message,"error")}}};a.get=function(f,c){if(b){try{var g=b.getItem(f);if(g!=null){return JSON.parse(g)}}catch(d){tfl.logs.create("tfl.storage.get:"+d.message,"error")}}if(c!==""){tfl.logs.create("tfl.storage.get: "+f+":"+c);return c}tfl.logs.create("tfl.storage.get: "+f+": []");return[]};a.showIfNotDisabled=function(g,c){if(b){try{var f=JSON.parse(a.get(g,false));if(!f){c()}}catch(d){c()}}else{c()}}}(window.tfl.storage=window.tfl.storage||{}));(function(a){a.extend(a.fn,{validate:function(c){if(!this.length){c&&c.debug&&window.console&&console.warn("nothing selected, can't validate, returning nothing");return}var d=a.data(this[0],"validator");if(d){return d}this.attr("novalidate","novalidate");d=new a.validator(c,this[0]);a.data(this[0],"validator",d);if(d.settings.onsubmit){var b=this.find("input, button");b.filter(".cancel").click(function(){d.cancelSubmit=true});if(d.settings.submitHandler){b.filter(":submit").click(function(){d.submitButton=this})}this.submit(function(e){if(d.settings.debug){e.preventDefault()}function f(){if(d.settings.submitHandler){if(d.submitButton){var g=a("<input type='hidden'/>").attr("name",d.submitButton.name).val(d.submitButton.value).appendTo(d.currentForm)}d.settings.submitHandler.call(d,d.currentForm);if(d.submitButton){g.remove()}return false}return true}if(d.cancelSubmit){d.cancelSubmit=false;return f()}if(d.form()){if(d.pendingRequest){d.formSubmitted=true;return false}return f()}else{d.focusInvalid();return false}})}return d},valid:function(){if(a(this[0]).is("form")){return this.validate().form()}else{var b=true;var c=a(this[0].form).validate();this.each(function(){b&=c.element(this)});return b}},removeAttrs:function(c){var d={},b=this;a.each(c.split(/\s/),function(e,f){d[f]=b.attr(f);b.removeAttr(f)});return d},rules:function(c,b){var e=this[0];if(c){var j=a.data(e.form,"validator").settings;var k=j.rules;var f=a.validator.staticRules(e);switch(c){case"add":a.extend(f,a.validator.normalizeRule(b));k[e.name]=f;if(b.messages){j.messages[e.name]=a.extend(j.messages[e.name],b.messages)}break;case"remove":if(!b){delete k[e.name];return f}var g={};a.each(b.split(/\s/),function(l,m){g[m]=f[m];delete f[m]});return g}}var d=a.validator.normalizeRules(a.extend({},a.validator.metadataRules(e),a.validator.classRules(e),a.validator.attributeRules(e),a.validator.staticRules(e)),e);if(d.required){var h=d.required;delete d.required;d=a.extend({required:h},d)}return d}});a.extend(a.expr[":"],{blank:function(b){return !a.trim(""+b.value)},filled:function(b){return !!a.trim(""+b.value)},unchecked:function(b){return !b.checked}});a.validator=function(c,b){this.settings=a.extend(true,{},a.validator.defaults,c);this.currentForm=b;this.init()};a.validator.format=function(c,b){if(arguments.length==1){return function(){var d=a.makeArray(arguments);d.unshift(c);return a.validator.format.apply(this,d)}}if(arguments.length>2&&b.constructor!=Array){b=a.makeArray(arguments).slice(1)}if(b.constructor!=Array){b=[b]}a.each(b,function(d,e){c=c.replace(new RegExp("\\{"+d+"\\}","g"),e)});return c};a.extend(a.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:a([]),errorLabelContainer:a([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(b,c){this.lastActive=b;if(this.settings.focusCleanup&&!this.blockFocusCleanup){this.settings.unhighlight&&this.settings.unhighlight.call(this,b,this.settings.errorClass,this.settings.validClass);this.addWrapper(this.errorsFor(b)).hide()}},onfocusout:function(b,c){if(!this.checkable(b)&&(b.name in this.submitted||!this.optional(b))){this.element(b)}},onkeyup:function(b,c){if(b.name in this.submitted||b==this.lastElement){this.element(b)}},onclick:function(b,c){if(b.name in this.submitted){this.element(b)}else{if(b.parentNode.name in this.submitted){this.element(b.parentNode)}}},highlight:function(b,c,d){if(b.type==="radio"){this.findByName(b.name).addClass(c).removeClass(d)}else{a(b).addClass(c).removeClass(d)}},unhighlight:function(b,c,d){if(b.type==="radio"){this.findByName(b.name).removeClass(c).addClass(d)}else{a(b).removeClass(c).addClass(d)}}},setDefaults:function(b){a.extend(a.validator.defaults,b)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",accept:"Please enter a value with a valid extension.",maxlength:a.validator.format("Please enter no more than {0} characters."),minlength:a.validator.format("Please enter at least {0} characters."),rangelength:a.validator.format("Please enter a value between {0} and {1} characters long."),range:a.validator.format("Please enter a value between {0} and {1}."),max:a.validator.format("Please enter a value less than or equal to {0}."),min:a.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=a(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||a(this.currentForm);this.containers=a(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var c=(this.groups={});a.each(this.settings.groups,function(e,f){a.each(f.split(/\s/),function(g,h){c[h]=e})});var d=this.settings.rules;a.each(d,function(e,f){d[e]=a.validator.normalizeRule(f)});function b(e){var g=a.data(this[0].form,"validator"),f="on"+e.type.replace(/^validate/,"");g.settings[f]&&g.settings[f].call(g,this[0],e)}a(this.currentForm).validateDelegate("[type='text'], [type='password'], [type='file'], select, textarea, [type='number'], [type='search'] ,[type='tel'], [type='url'], [type='email'], [type='datetime'], [type='date'], [type='month'], [type='week'], [type='time'], [type='datetime-local'], [type='range'], [type='color'] ","focusin focusout keyup",b).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",b);if(this.settings.invalidHandler){a(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();a.extend(this.submitted,this.errorMap);this.invalid=a.extend({},this.errorMap);if(!this.valid()){a(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var c=0,b=(this.currentElements=this.elements());b[c];c++){this.check(b[c])}return this.valid()},element:function(b){b=this.validationTargetFor(this.clean(b));this.lastElement=b;this.prepareElement(b);this.currentElements=a(b);var c=this.check(b);if(c){delete this.invalid[b.name]}else{this.invalid[b.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return c},showErrors:function(b){if(b){a.extend(this.errorMap,b);this.errorList=[];for(var c in b){this.errorList.push({message:b[c],element:this.findByName(c)[0]})}this.successList=a.grep(this.successList,function(d){return !(d.name in b)})}this.settings.showErrors?this.settings.showErrors.call(this,this.errorMap,this.errorList):this.defaultShowErrors()},resetForm:function(){if(a.fn.resetForm){a(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass)},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(d){var b=0;for(var c in d){b++}return b},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()==0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{a(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(b){}}},findLastActive:function(){var b=this.lastActive;return b&&a.grep(this.errorList,function(c){return c.element.name==b.name}).length==1&&b},elements:function(){var c=this,b={};return a(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){!this.name&&c.settings.debug&&window.console&&console.error("%o has no name assigned",this);if(this.name in b||!c.objectLength(a(this).rules())){return false}b[this.name]=true;return true})},clean:function(b){return a(b)[0]},errors:function(){return a(this.settings.errorElement+"."+this.settings.errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=a([]);this.toHide=a([]);this.currentElements=a([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(b){this.reset();this.toHide=this.errorsFor(b)},check:function(d){d=this.validationTargetFor(this.clean(d));var j=a(d).rules();var b=false;for(var f in j){var h={method:f,parameters:j[f]};try{var g=a.validator.methods[f].call(this,d.value.replace(/\r/g,""),d,h.parameters);if(g=="dependency-mismatch"){b=true;continue}b=false;if(g=="pending"){this.toHide=this.toHide.not(this.errorsFor(d));return}if(!g){this.formatAndAdd(d,h);return false}}catch(c){this.settings.debug&&window.console&&console.log("exception occured when checking element "+d.id+", check the '"+h.method+"' method",c);throw c}}if(b){return}if(this.objectLength(j)){this.successList.push(d)}return true},customMetaMessage:function(b,d){if(!a.metadata){return}var c=this.settings.meta?a(b).metadata()[this.settings.meta]:a(b).metadata();return c&&c.messages&&c.messages[d]},customMessage:function(d,c){var b=this.settings.messages[d];return b&&(b.constructor==String?b:b[c])},findDefined:function(){for(var b=0;b<arguments.length;b++){if(arguments[b]!==undefined){return arguments[b]}}return undefined},defaultMessage:function(b,c){return this.findDefined(this.customMessage(b.name,c),this.customMetaMessage(b,c),!this.settings.ignoreTitle&&b.title||undefined,a.validator.messages[c],"<strong>Warning: No message defined for "+b.name+"</strong>")},formatAndAdd:function(b,d){var c=this.defaultMessage(b,d.method),e=/\$?\{(\d+)\}/g;if(typeof c=="function"){c=c.call(this,d.parameters,b)}else{if(e.test(c)){c=jQuery.format(c.replace(e,"{$1}"),d.parameters)}}this.errorList.push({message:c,element:b});this.errorMap[b.name]=c;this.submitted[b.name]=c},addWrapper:function(b){if(this.settings.wrapper){b=b.add(b.parent(this.settings.wrapper))}return b},defaultShowErrors:function(){for(var d=0;this.errorList[d];d++){var c=this.errorList[d];this.settings.highlight&&this.settings.highlight.call(this,c.element,this.settings.errorClass,this.settings.validClass);this.showLabel(c.element,c.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(var d=0;this.successList[d];d++){this.showLabel(this.successList[d])}}if(this.settings.unhighlight){for(var d=0,b=this.validElements();b[d];d++){this.settings.unhighlight.call(this,b[d],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return a(this.errorList).map(function(){return this.element})},showLabel:function(b,d){var c=this.errorsFor(b);if(c.length){c.removeClass(this.settings.validClass).addClass(this.settings.errorClass);c.attr("generated")&&c.html(d)}else{c=a("<"+this.settings.errorElement+"/>").attr({"for":this.idOrName(b),generated:true}).addClass(this.settings.errorClass).html(d||"");if(this.settings.wrapper){c=c.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(c).length){this.settings.errorPlacement?this.settings.errorPlacement(c,a(b)):c.insertAfter(b)}}if(!d&&this.settings.success){c.text("");typeof this.settings.success=="string"?c.addClass(this.settings.success):this.settings.success(c)}this.toShow=this.toShow.add(c)},errorsFor:function(b){var c=this.idOrName(b);return this.errors().filter(function(){return a(this).attr("for")==c})},idOrName:function(b){return this.groups[b.name]||(this.checkable(b)?b.name:b.id||b.name)},validationTargetFor:function(b){if(this.checkable(b)){b=this.findByName(b.name).not(this.settings.ignore)[0]}return b},checkable:function(b){return/radio|checkbox/i.test(b.type)},findByName:function(c){var b=this.currentForm;return a(document.getElementsByName(c)).map(function(e,d){return d.form==b&&d.name==c&&d||null})},getLength:function(c,b){switch(b.nodeName.toLowerCase()){case"select":return a("option:selected",b).length;case"input":if(this.checkable(b)){return this.findByName(b.name).filter(":checked").length}}return c.length},depend:function(c,b){return this.dependTypes[typeof c]?this.dependTypes[typeof c](c,b):true},dependTypes:{"boolean":function(c,b){return c},string:function(c,b){return !!a(c,b.form).length},"function":function(c,b){return c(b)}},optional:function(b){return !a.validator.methods.required.call(this,a.trim(b.value),b)&&"dependency-mismatch"},startRequest:function(b){if(!this.pending[b.name]){this.pendingRequest++;this.pending[b.name]=true}},stopRequest:function(b,c){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[b.name];if(c&&this.pendingRequest==0&&this.formSubmitted&&this.form()){a(this.currentForm).submit();this.formSubmitted=false}else{if(!c&&this.pendingRequest==0&&this.formSubmitted){a(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}}},previousValue:function(b){return a.data(b,"previousValue")||a.data(b,"previousValue",{old:null,valid:true,message:this.defaultMessage(b,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},dateDE:{dateDE:true},number:{number:true},numberDE:{numberDE:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(b,c){b.constructor==String?this.classRuleSettings[b]=c:a.extend(this.classRuleSettings,b)},classRules:function(c){var d={};var b=a(c).attr("class");b&&a.each(b.split(" "),function(){if(this in a.validator.classRuleSettings){a.extend(d,a.validator.classRuleSettings[this])}});return d},attributeRules:function(c){var e={};var b=a(c);for(var d in a.validator.methods){var f;if(d==="required"&&typeof a.fn.prop==="function"){f=b.prop(d)}else{f=b.attr(d)}if(f){e[d]=f}else{if(b[0].getAttribute("type")===d){e[d]=true}}}if(e.maxlength&&/-1|2147483647|524288/.test(e.maxlength)){delete e.maxlength}return e},metadataRules:function(b){if(!a.metadata){return{}}var c=a.data(b.form,"validator").settings.meta;return c?a(b).metadata()[c]:a(b).metadata()},staticRules:function(b){var c={};var d=a.data(b.form,"validator");if(d.settings.rules){c=a.validator.normalizeRule(d.settings.rules[b.name])||{}}return c},normalizeRules:function(c,b){a.each(c,function(e,f){if(f===false){delete c[e];return}if(f.param||f.depends){var d=true;switch(typeof f.depends){case"string":d=!!a(f.depends,b.form).length;break;case"function":d=f.depends.call(b,b);break}if(d){c[e]=f.param!==undefined?f.param:true}else{delete c[e]}}});a.each(c,function(e,d){c[e]=a.isFunction(d)?d(b):d});a.each(["minlength","maxlength","min","max"],function(){if(c[this]){c[this]=Number(c[this])}});a.each(["rangelength","range"],function(){if(c[this]){c[this]=[Number(c[this][0]),Number(c[this][1])]}});if(a.validator.autoCreateRanges){if(c.min&&c.max){c.range=[c.min,c.max];delete c.min;delete c.max}if(c.minlength&&c.maxlength){c.rangelength=[c.minlength,c.maxlength];delete c.minlength;delete c.maxlength}}if(c.messages){delete c.messages}return c},normalizeRule:function(b){if(typeof b=="string"){var c={};a.each(b.split(/\s/),function(){c[this]=true});b=c}return b},addMethod:function(d,c,b){a.validator.methods[d]=c;a.validator.messages[d]=b!=undefined?b:a.validator.messages[d];if(c.length<3){a.validator.addClassRules(d,a.validator.normalizeRule(d))}},methods:{required:function(e,b,c){if(!this.depend(c,b)){return"dependency-mismatch"}switch(b.nodeName.toLowerCase()){case"select":var d=a(b).val();return d&&d.length>0;case"input":if(this.checkable(b)){return this.getLength(e,b)>0}default:return a.trim(e).length>0}},remote:function(g,c,d){if(this.optional(c)){return"dependency-mismatch"}var e=this.previousValue(c);if(!this.settings.messages[c.name]){this.settings.messages[c.name]={}}e.originalMessage=this.settings.messages[c.name].remote;this.settings.messages[c.name].remote=e.message;d=typeof d=="string"&&{url:d}||d;if(this.pending[c.name]){return"pending"}if(e.old===g){return e.valid}e.old=g;var f=this;this.startRequest(c);var b={};b[c.name]=g;a.ajax(a.extend(true,{url:d,mode:"abort",port:"validate"+c.name,dataType:"json",data:b,success:function(k){f.settings.messages[c.name].remote=e.originalMessage;var m=k===true;if(m){var l=f.formSubmitted;f.prepareElement(c);f.formSubmitted=l;f.successList.push(c);f.showErrors()}else{var h={};var j=k||f.defaultMessage(c,"remote");h[c.name]=e.message=a.isFunction(j)?j(g):j;f.showErrors(h)}e.valid=m;f.stopRequest(c,m)}},d));return"pending"},minlength:function(d,b,c){return this.optional(b)||this.getLength(a.trim(d),b)>=c},maxlength:function(d,b,c){return this.optional(b)||this.getLength(a.trim(d),b)<=c},rangelength:function(e,b,d){var c=this.getLength(a.trim(e),b);return this.optional(b)||(c>=d[0]&&c<=d[1])},min:function(d,b,c){return this.optional(b)||d>=c},max:function(d,b,c){return this.optional(b)||d<=c},range:function(d,b,c){return this.optional(b)||(d>=c[0]&&d<=c[1])},email:function(c,b){return this.optional(b)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(c)},url:function(c,b){return this.optional(b)||/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(c)},date:function(c,b){return this.optional(b)||!/Invalid|NaN/.test(new Date(c))},dateISO:function(c,b){return this.optional(b)||/^\d{4}[\/-]\d{1,2}[\/-]\d{1,2}$/.test(c)},number:function(c,b){return this.optional(b)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/.test(c)},digits:function(c,b){return this.optional(b)||/^\d+$/.test(c)},creditcard:function(h,d){if(this.optional(d)){return"dependency-mismatch"}if(/[^0-9 -]+/.test(h)){return false}var f=0,g=0,b=false;h=h.replace(/\D/g,"");for(var e=h.length-1;e>=0;e--){var c=h.charAt(e);var g=parseInt(c,10);if(b){if((g*=2)>9){g-=9}}f+=g;b=!b}return(f%10)==0},accept:function(d,b,c){c=typeof c=="string"?c.replace(/,/g,"|"):"png|jpe?g|gif";return this.optional(b)||d.match(new RegExp(".("+c+")$","i"))},equalTo:function(e,b,c){var d=a(c).unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){a(b).valid()});return e==d.val()}}});a.format=a.validator.format})(jQuery);(function(a){var c={};if(a.ajaxPrefilter){a.ajaxPrefilter(function(f,d,g){var e=f.port;if(f.mode=="abort"){if(c[e]){c[e].abort()}c[e]=g}})}else{var b=a.ajax;a.ajax=function(f){var d=("mode" in f?f:a.ajaxSettings).mode,e=("port" in f?f:a.ajaxSettings).port;if(d=="abort"){if(c[e]){c[e].abort()}return(c[e]=b.apply(this,arguments))}return b.apply(this,arguments)}}})(jQuery);(function(a){if(!jQuery.event.special.focusin&&!jQuery.event.special.focusout&&document.addEventListener){a.each({focus:"focusin",blur:"focusout"},function(d,b){a.event.special[b]={setup:function(){this.addEventListener(d,c,true)},teardown:function(){this.removeEventListener(d,c,true)},handler:function(f){arguments[0]=a.event.fix(f);arguments[0].type=b;return a.event.handle.apply(this,arguments)}};function c(f){f=a.event.fix(f);f.type=b;return a.event.handle.call(this,f)}})}a.extend(a.fn,{validateDelegate:function(b,d,c){return this.bind(d,function(e){var f=a(e.target);if(f.is(b)){return c.apply(f,arguments)}})}})})(jQuery);(function(m){var p=m.validator,n,r="unobtrusiveValidation";function o(d,e,f){d.rules[e]=f;if(d.message){d.messages[e]=d.message}}function u(b){return b.replace(/^\s+|\s+$/g,"").split(/\s*,\s*/g)}function s(b){return b.substr(0,b.lastIndexOf(".")+1)}function q(c,d){if(c.indexOf("*.")===0){c=c.replace("*.",d)}return c}function y(f,g){var a=m(this).find("[data-valmsg-for='"+g[0].name+"']"),h=m.parseJSON(a.attr("data-valmsg-replace"))!==false;a.removeClass("field-validation-valid").addClass("field-validation-error");f.data("unobtrusiveContainer",a);if(h){a.empty();f.removeClass("input-validation-error").appendTo(a)}else{f.hide()}}function w(h,g){var f=m(this).find("[data-valmsg-summary=true]"),a=f.find("ul");if(a&&a.length&&g.errorList.length){a.empty();f.addClass("validation-summary-errors").removeClass("validation-summary-valid");m.each(g.errorList,function(){m("<li />").html(this.message).appendTo(a)})}}function v(e){var a=e.data("unobtrusiveContainer"),f=m.parseJSON(a.attr("data-valmsg-replace"));if(a){a.addClass("field-validation-valid").removeClass("field-validation-error");e.removeData("unobtrusiveContainer");f&&a.empty()}}function t(f){var a=m(f),e=a.data(r);if(!e){e={options:{errorClass:"input-validation-error",errorElement:"span",errorPlacement:m.proxy(y,f),invalidHandler:m.proxy(w,f),messages:{},rules:{},success:m.proxy(v,f)},attachValidation:function(){a.validate(this.options)},validate:function(){a.validate();return a.valid()}};a.data(r,e)}return e}p.unobtrusive={adapters:[],parseElement:function(a,A){var j=m(a),l=j.parents("form")[0],h,k,z;if(!l){return}h=t(l);h.options.rules[a.name]=k={};h.options.messages[a.name]=z={};m.each(this.adapters,function(){var b="data-val-"+this.name,e=j.attr(b),d={};if(e!==undefined){b+="-";m.each(this.params,function(){d[this]=j.attr(b+this)});this.adapt({element:a,form:l,message:e,params:d,rules:k,messages:z})}});jQuery.extend(k,{__dummy__:true});!A&&h.attachValidation()},parse:function(a){m(a).find(":input[data-val=true]").each(function(){p.unobtrusive.parseElement(this,true)});m("form").each(function(){var b=t(this);b&&b.attachValidation()})}};n=p.unobtrusive.adapters;n.add=function(f,d,e){if(!e){e=d;d=[]}this.push({name:f,params:d,adapt:e});return this};n.addBool=function(c,d){return this.add(c,function(a){o(a,d||c,true)})};n.addMinMax=function(k,z,l,c,j,h){return this.add(k,[j||"min",h||"max"],function(a){var g=a.params.min,f=a.params.max;if(g&&f){o(a,c,[g,f])}else{if(g){o(a,z,g)}else{f&&o(a,l,f)}}})};n.addSingleVal=function(c,e,f){return this.add(c,[e||"val"],function(a){o(a,f||c,a.params[e])})};p.addMethod("__dummy__",function(){return true});p.addMethod("regex",function(f,g,h){var e;if(this.optional(g)){return true}e=(new RegExp(h)).exec(f);return e&&e.index===0&&e[0].length===f.length});n.addSingleVal("accept","exts").addSingleVal("regex","pattern");n.addBool("creditcard").addBool("date").addBool("digits").addBool("email").addBool("number").addBool("url");n.addMinMax("length","minlength","maxlength","rangelength").addMinMax("range","min","max","range");n.add("equalto",["other"],function(a){var g=s(a.element.name),j=a.params.other,c=q(j,g),e=m(a.form).find(":input[name="+c+"]")[0];o(a,"equalTo",e)});n.add("required",function(b){(b.element.tagName.toUpperCase()!=="INPUT"||b.element.type.toUpperCase()!=="CHECKBOX")&&o(b,"required",true)});n.add("remote",["url","type","additionalfields"],function(a){var c={url:a.params.url,type:a.params.type||"GET",data:{}},e=s(a.element.name);m.each(u(a.params.additionalfields||a.element.name),function(f,d){var b=q(d,e);c.data[b]=function(){return m(a.form).find(":input[name='"+b+"']").val()}});o(a,"remote",c)});m(function(){p.unobtrusive.parse(document)})})(jQuery);(function(d){tfl.logs.create("tfl.utils: loaded");d.supportsSVG=function(){if(!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect){d.supportsSVG=function(){return true}}else{$(document.body).addClass("nosvg");d.supportsSVG=function(){return false}}};d.supportsFlexbox=function(){var f=["flexWrap","webkitFlexWrap","mozFlexWrap","msFlexWrap"];for(var e in f){if(document.body.style[e]!==undefined){$(document.body).addClass("flexbox");d.supportsFlexbox=function(){return true};return true}}$(document.body).addClass("no-flexbox");d.supportsFlexbox=function(){return false};return false};d.isTouchDevice=function(){return !!("ontouchstart" in window)||!!("onmsgesturechange" in window)};d.requestAnimFrame;function b(){if(window.requestAnimationFrame){d.requestAnimFrame=function(e){window.requestAnimationFrame(e)}}else{if(window.webkitRequestAnimationFrame){d.requestAnimFrame=function(e){window.webkitRequestAnimationFrame(e)}}else{if(window.mozRequestAnimationFrame){d.requestAnimFrame=function(e){window.mozRequestAnimationFrame(e)}}else{d.requestAnimFrame=function(e){window.setTimeout(e,1000/60)}}}}}function c(){Array.prototype.indexOf=function(h){if(this==null){throw new TypeError()}var g,e,j=Object(this),f=j.length>>>0;if(f===0){return -1}g=0;if(arguments.length>1){g=Number(arguments[1]);if(g!=g){g=0}else{if(g!=0&&g!=Infinity&&g!=-Infinity){g=(g>0||-1)*Math.floor(Math.abs(g))}}}if(g>=f){return -1}for(e=g>=0?g:Math.max(f-Math.abs(g),0);e<f;e++){if(e in j&&j[e]===h){return e}}return -1}}d.runOnImgComplete=function(f,e){if(f.nodeType===1&&f.tagName.toLowerCase()==="img"&&f.src!==""){if(f.complete||f.readyState===4){e()}else{if(f.readyState==="uninitialized"&&f.src.indexOf("data:")===0){tfl.logs.create("tfl.utils.runOnImgComplete: failed to load "+f.src)}else{f.one("load",e)}}}};function a(){tfl.logs.create("tfl.utils: started");d.supportsSVG();if(!Array.prototype.indexOf){c()}b()}a()})(window.tfl.utils=window.tfl.utils||{});(function(a){a.dictionary={MoreOptions:"Accessibility & travel options",LessOptions:"Fewer options",CustomisedOptions:$.cookie("jp-pref")!==null?" (customised)":"",ShowDetailedView:"View Details",HideDetailedView:"Hide Details",ShowAllStops:"View all stops",HideAllStops:"Hide all stops",ShowTextInstructions:"View text instructions",HideTextInstructions:"Hide text instructions",NowText:"Now",TodayText:"Today",RemoveContentClass:".remove-content",JpTypeCycling:"cycling",JpTypeWalking:"walking",FirstServiceText:"First service",LastServiceText:"Last service",CurrentLocationText:"Current location "};a.logs.create("tfl.dictionary: loaded")})(window.tfl=window.tfl||{});(function(b){function a(c){if(c===undefined){tfl.logs.create("error instantiating object - mandatory field not populated");return false}return true}b.modes=[tfl.modeNameTube,tfl.modeNameBus,tfl.modeNameTram,tfl.modeNameRiver,tfl.modeNameCableCar,tfl.modeNameMultiModal];b.SSPObject=function(d,c,e){var e=e||{};if(!a(d)||!a(c)){return{error:"naptanId and mode are mandatory"}}if(b.modes.indexOf(c)<0){return{error:"invalid mode supplied"}}this.naptanId=d;this.mode=c;this.props=$.extend({lines:[],name:"",towards:""},e)};tfl.logs.create("tfl.objects: loaded")})(window.tfl.objects=window.tfl.objects||{});var tfl=tfl||{};(function(a){a.logs.create("tfl.core: loaded");a.init=function(){a.logs.create("tfl.core: started");a.responsive.init();a.interactions.init()};a.getQueryParam=function(b,f){if(!f){f=window.location.search}b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]").toLowerCase();var d="[\\?&]"+b+"=([^&#]*)";var c=new RegExp(d);var e=c.exec(f.toLowerCase());if(e==null){return""}else{return decodeURIComponent(e[1].replace(/\+/g," "))}};a.interactions={init:function(){a.logs.create("tfl.interactions: started");a.interactions.externalLinks();$(".top-row .more").click(a.interactions.toggleNavigation);$(".show-mobile-search").click(a.interactions.toggleMobileSearch);$("#footer h2.heading").wrap('<a href="#info-for" class="info-for-link" />');$("#footer a.info-for-link").click(a.interactions.toggleFooter);$(".cookie-policy-button a").click(a.interactions.hideCookiesPolicyNotice);a.storage.showIfNotDisabled("cookiePolicyNoticeHidden",function(){$(".cookie-policy-notice").show()});$(document).keydown(function(d){var f=[],b=$(document.activeElement);if(d.shiftKey&&d.keyCode==9){var c=b.attr("data-jumpback")||b.data("jumpback");if(c!==undefined){f=typeof(c)==="string"?$(c):f=c}}else{if(d.which==9){var g=b.attr("data-jumpto")||b.data("jumpto");if(g!==undefined){f=typeof(g)==="string"?$(g):f=g}}}if(f.length>0){f=f.length>1?f.first():f;f.focus();$(".ui-menu-item").hide();return false}});$("input[type='text']").attr("autocomplete","off")},hideCookiesPolicyNotice:function(){$(".cookie-policy-notice").hide();a.storage.set("cookiePolicyNoticeHidden","true");if($("html.lt-ie8").length>0){var b=$(".top-row, #full-width-content");b.addClass("ie7-fix");window.setTimeout(function(){b.removeClass("ie7-fix")},5)}return false},toggleNavigation:function(){var b=$(".extra-nav");if($(".top-row.show-search").is(":visible")){a.interactions.toggleMobileSearch()}$(".top-row .more").children("a").toggleClass("expanded");b.toggleClass("expanded");$("#container").toggleClass("menu-visible");b.find(".menu-sub-section:last").find("ul").find("li:last").find("a").blur(function(){$("input#q").focus()});return false},externalLinks:function(){a.logs.create("external link classes: initialised");$("a").filter(function(){return this.hostname&&this.hostname!==location.hostname}).addClass("external-link");$("a.external-link,a.document-download-wrap").attr("target","_parent");a.logs.create("external link classes: added");var b=$("p a.external-link").each(function(){var c=$(this).attr("href");$(this).after("<a class='ext-span' href="+c+"></a>")})},toggleMobileSearch:function(){if($(".extra-nav.expanded").is(":visible")){a.interactions.toggleNavigation()}var b=$(".show-mobile-search");var c=".journey-form #plan-a-journey tabbable:first,#main-hero :tabbable:first";var d="#query";if(b.attr("data-jumpto")===c){b.attr("data-jumpto",d)}else{if(b.attr("data-jumpto")===d){b.attr("data-jumpto",c)}}$(".search-tools").find("a").css("top","5px");$(".top-row").toggleClass("show-search");return false},toggleFooter:function(){$(".primary-footer").toggleClass("expanded");return false}};a.responsive={init:function(){a.logs.create("tfl.responsive: started");a.responsive.setupBreakpoints();$(".top-row .logo").after("<ul class='collapsible-menu clearfix'>&nbsp;</ul>");var b=$(".collapsible-menu");b.append($(".plan-journey").clone());b.append($(".status-update").clone());b.append($(".maps").clone());b.append($(".fares-and-payments").clone());$(".collapsible-menu a").removeAttr("data-jumpback");b.append("<li class='more'><a href='javascript:void(0)' data-jumpto='.extra-nav a:visible:first'><span class='text'>More...</span><span class='arrow'>&nbsp;</span></a></li></li>");$(".texts").append('<div class="search"><a href="javascript:void(0);" class="show-mobile-search" data-jumpto=".journey-form #plan-a-journey tabbable:first,#main-hero :tabbable:first"><span class="search-icon hide-text">Search</span><span class="collapse"></span><span class="expand"></span></a></div>');$(".top-row-extras").prepend("<div class='more'><a href='javascript:void(0)' data-jumpto='.extra-nav a:first:visible'><span class='text'>Menu</span><span class='arrow'>&nbsp;</span></a></li></div>");$(".moving-source-order").appendAround();a.responsive.initLazyLoadedImages()},setupBreakpoints:function(){$(window).setBreakpoints({distinct:false,breakpoints:a.settings.devices})},initLazyLoadedImages:function(){$("[data-img]").each(function(){var c=$(this);var b=function(){$(c).children("img").remove();var d=$("<img>").attr({src:c.attr("data-img"),alt:c.attr("data-img-alt")}).load(function(){if(c.data("img-background")){c.css("background-image","url("+c.attr("data-img")+")")}else{c.prepend(d);d.attr({width:d.width(),height:d.height()})}});if(d[0].width){d.load()}};if($(this).attr("data-img-breakpoint")==="medium"){$(window).one("enterBreakpointMedium",b);if($("body.breakpoint-Medium").length>0){$(window).trigger("enterBreakpointMedium")}}else{$(window).one("enterBreakpointLarge",b);if($("body.breakpoint-Large").length>0){$(window).trigger("enterBreakpointLarge")}}})}};$.fn.tflPopup=function(q){var p=$(this);var t=$.extend({title:"This is the default title",content:"",showingPercentage:100,displayNoThanksLink:true,displayNotAgainLink:true,noThanksLinkText:"No thanks",notAgainLinkText:"No thanks, and don't ask me again",links:[],campaignId:"DefaultPopup",},q);if(a.storage.get("Popups."+t.campaignId)){return}if(t.showingPercentage<100){var s=Math.floor(Math.random()*100);if(s>t.showingPercentage){return}}var r=$("<div></div>").addClass("popup");var u=$("<div></div>").addClass("popup-title").text(t.title);var j=$('<span class="popup-title-icon white-up-arrow"></span>');var c=$("<div></div>").addClass("popup-content");if(t.content.length>0){c.append($("<p></p>").text(t.content))}for(var h=0;h<t.links.length;h++){var k=t.links[h];var m=$("<a></a>").attr({href:k.url,title:k.title}).addClass("plain-button").text(k.title);c.append(m)}var g=function(l){r.addClass("hidden");l.preventDefault()};var b=function(l){a.storage.set("Popups."+t.campaignId,true);l.preventDefault()};if(t.displayNoThanksLink){var o=$("<a></a>").attr({href:"#",title:t.noThanksLinkText}).addClass("plain-button").text(t.noThanksLinkText);c.append(o);o.click(g)}if(t.displayNotAgainLink&&a.storage.isLocalStorageSupported()){var n=$("<a></a>").attr({href:"#",title:t.notAgainLinkText}).addClass("plain-button").text(t.notAgainLinkText);c.append(n);n.click(g).click(b)}r.append(u.append(j)).append(c);p.append(r);var f=c.outerHeight(true);var d={bottom:(f*-1)+"px"};var e={bottom:0};r.click(function(){var l=$(this);if(l.css("bottom")==="0px"){l.css(d);j.attr("class","popup-title-icon white-up-arrow")}else{l.css(e);j.attr("class","popup-title-icon white-down-arrow")}}).css(d)};$.fn.tflBanner=function(j){var h=$(this);var n=$.extend({title:"This is the default title",showingPercentage:100,links:[],campaignId:"DefaultBanner"},j);if(n.showingPercentage===0||a.storage.get("Banners."+n.campaignId)){return}if(n.showingPercentage<100){var m=Math.floor(Math.random()*100);if(m>n.showingPercentage){return}}var c=function(l){k.addClass("hidden");l.preventDefault()};var b=function(l){a.storage.set("Banners."+n.campaignId,true);l.preventDefault()};var k=$("<div></div>").addClass("popup-banner");var o=$("<span></span>").addClass("popup-title").text(n.title);var e=$('<a href="#" class="popup-title-icon close-icon-white hide-text"><span>Close this banner</span></a>');e.click(c).click(b);for(var d=0;d<n.links.length;d++){var f=n.links[d];var g=$("<a></a>").attr({href:f.url,title:f.title,"class":"popup-link"}).text(f.title);o.append(g)}k.append(o).append(e);h.append(k)};a.init()})(tfl);(function(c){var a=new Array();c.api={BikePoint:c.apiUrl+"BikePoint",LineStatus:c.apiUrl+"Line/Mode/{0}/Status?detail=true",LinePlannedWorks:c.apiUrl+"Line/Mode/{0}/Status/{1}/to/{2}?detail=true",Routes:c.apiUrl+"Routes",RoutesSearch:c.apiUrl+"Search/Route/%QUERY?includelines=true&includestations=false&modes={0}",StopPointsDisruptions:c.apiUrl+"StopPoint/{0}/Disruption",StopPointsSearch:c.apiUrl+"StopPoint/search/%QUERY?modes={0}&maxResults=25&oysterOnly={1}",StopPointsDisruptionsTimePeriod:c.apiUrl+"StopPoint/{0}/Disruption/{1}/to/{2}",StopPointsDisruptionsByModeAndTimePeriod:c.apiUrl+"StopPoint/Mode/{0}/Disruption/{1}/to/{2}"};c.autoRefresh={BikePoint:65000,Predictions:10000,ServiceBoard:65000};var b=c.settings.debug?{}:{app_id:c.appId,app_key:c.appKey};c.addAppIdAndKey=function(d){if(!c.settings.debug){if(d.indexOf("?")!=-1){return d+"&app_id="+c.appId+"&app_key="+c.appKey}else{return d+"?app_id="+c.appId+"&app_key="+c.appKey}}else{return d}};c.ajax=function(f){if(typeof(f)!=="object"||!f.url||!f.success){c.logs.create("invalid paramaters passed to tfl.ajax");c.logs.create(f);if(typeof(f.error)==="function"){f.error()}return false}var e={data:b,dataType:"json",success:null,error:function(j,k,h){c.logs.create("tfl.ajax: Error with ajax call");c.logs.create(k);c.logs.create(h);c.logs.create(j)},autoRefreshInterval:null};var g=$.extend(true,{},e,f);if(g.autoRefreshInterval!==null){g.complete=function(){a[g.autoRefreshId]=setTimeout(function(){c.ajax(f)},parseInt(g.autoRefreshInterval))}}var d=function(){c.logs.create("tfl.ajax: "+g.url);$.ajax(g)};c.utils.requestAnimFrame(d)};c.stopAjaxAutoRefresh=function(d){clearTimeout(a[d])};c.logs.create("tfl.ajax: loaded")})(window.tfl=window.tfl||{});(function(a){a.settings=function(){$.validator.setDefaults({onfocusout:false,onfocusin:false,onkeyup:false,onclick:false})};a.setSelectBoxSpan=function(b){var c=$(b).children("option:selected").text();$(b).attr("title",c).siblings("span").text(c)};a.updateSelectBox=function(){a.setSelectBoxSpan(this)},a.setupSelectBoxes=function(){$(".selector select").before("<span />").each(function(){a.setSelectBoxSpan(this);$(this).focus(function(){$(this).parent().addClass("focus")});$(this).blur(function(){$(this).parent().removeClass("focus")})}).change(a.updateSelectBox)};a.setupSelectBox=function(b,c){$(b+" select").before("<span />");$(b+" select").attr("title",c).siblings("span").text(c);$(b).focus(function(){$(b).parent().addClass("focus")});$(b).blur(function(){$(b).parent().removeClass("focus")});$(b+" select").change(a.updateSelectBox)};a.modeSelectAll=function(b){$(b).click(function(){var c=$(this).parent().siblings("ul");if(!$(this).hasClass("select-all")){c.children("li.ticked").each(function(){$(this).children("input").trigger("click")})}else{c.children("li").not(".ticked").each(function(){$(this).children("input").trigger("click")});$(this).removeClass("select-all").text("Deselect all")}})};a.setupCheckBoxSelectall=function(d){var c=$("<div class='select-deselect-option'><a href='javascript:void(0);'>Deselect All</a></div>");var f=c.children("a");$(d).parent().prepend(c);var e=$(d).find("input");var b=function(){var g=true;for(var h=0;h<e.length;h++){if(!$(e[h]).is(":checked")){g=false;break}}if(g){f.text("Deselect all");f.removeClass("select-all")}else{f.text("Select all");f.addClass("select-all")}};e.click(b);b();a.modeSelectAll(f)};a.setupCheckboxLists=function(){tfl.logs.create("tfl.forms: setup checkbox lists");$(".to-checkbox-list").each(function(){var c=$("<ul class='clearfix'></ul>");var b=1;var d=$(this).children("option").length;$(this).children().each(function(){var g=$("<li></li>");if(b%2===1){g.addClass("odd")}var j=$(this).attr("value");var e=$(this).text();var f=$("<input type='checkbox' />").attr("id",j);if($(this).attr("selected")!==undefined){f.attr("checked","checked")}g.append(f);var h=$("<label for='"+j+"' class='"+j+"'></label>");h.append(e);g.append(h);c.append(g);b++});$(this).after(c);if($(this).hasClass("select-all")){c.addClass("select-all");a.setupCheckBoxSelectall(c)}$(this).hide()})};a.setupHorizontalToggles=function(){tfl.logs.create("tfl.forms: setup horizontal toggles");$(".horizontal-toggle-buttons").each(function(){var b=$(this).find("input");b.filter(":checked").parent().addClass("selected");b.focus(function(){$(this).parent().addClass("focus")});b.blur(function(){$(this).parent().removeClass("focus")});var c=b.parent();b.change(function(){c.removeClass("selected");$(this).parent().addClass("selected")})})};a.setupCustomInputs=function(){$(".checkbox-list input[type='checkbox'], .radiobutton-list input[type='radio'], .styled-checkbox input[type='checkbox']").each(function(){if($(this).attr("checked")==="checked"){$(this).parent().addClass("ticked")}$(this).focus(function(){$(this).parent().addClass("focus")});$(this).blur(function(){$(this).parent().removeClass("focus")})})};a.toggleCustomInput=function(c){var d=$(this).parents(".radiobutton-list");if(d.length>0){$(this).parent().parent().children("li,.radiobutton-list-item").removeClass("ticked")}$(this).parent().toggleClass("ticked");var f=$(this).parent().parent().prev("select.to-checkbox-list");if(f.length>0){var b=$(this);var g=function(){var e=b.attr("checked")==="checked";if(e){f.find("option[value='"+b.attr("id")+"']").attr("selected","selected")}else{f.find("option[value='"+b.attr("id")+"']").removeAttr("selected")}};setTimeout(g,10)}};a.toggleMoreInfo=function(b){b.preventDefault();$(this).closest(".more-info-header").toggleClass("expanded")};a.init=function(b){a.settings();a.setupSelectBoxes();a.setupCheckboxLists();a.setupHorizontalToggles();a.setupCustomInputs();$(".checkbox-list input[type='checkbox'], .radiobutton-list input[type='radio']").click(a.toggleCustomInput);$(".styled-checkbox input[type='checkbox']").click(a.toggleCustomInput);$(".more-info-header .show-more-info").click(a.toggleMoreInfo)};a.init()}(window.tfl.forms=window.tfl.forms||{}));(function(a){tfl.logs.create("tfl.geolocation: loaded");a.minAccuracy=1000;a.geocoder=null;a.geolocationTimeout=10000;a.isGeolocationSupported=function(){if("geolocation" in navigator&&navigator.geolocation!==null){tfl.logs.create("tfl.geolocation: isGeolocationSupported true");return true}else{tfl.logs.create("tfl.geolocation: isGeolocationSupported false");return false}};a.geolocateMe=function(g,b){tfl.logs.create("tfl.geolocation: geolocate me");a.clearGeolocationError();var d=$(g);d.typeahead("setQuery","");d.originalPlaceholder=d.attr("placeholder");d.attr("placeholder","Finding address...");var h=function(e){if(e.coords&&e.coords.accuracy&&e.coords.accuracy>tfl.geolocation.minAccuracy){tfl.logs.create("tfl.geolocation.geolocate me: ERROR: inaccuracy too high: "+e.coords.accuracy+"m");a.geolocationError("We cannot find your current location. Please try again",d);d.parent().siblings(tfl.removableContent.RemoveContentClass).hide();return}$(g+"Geolocation").val(e.coords.longitude+","+e.coords.latitude);a.setupInputBoxForGeolocation(d);if(b){b()}};var f=function(e){d.parent().siblings(tfl.removableContent.RemoveContentClass).hide();d.closest("[data-current-location]").removeAttr("data-current-location");if(e.code){if(e.code===1){tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: permission denied");a.geolocationError("Permission from browser needed before finding your location",d)}else{if(e.code===2){tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: position unavailable");a.geolocationError("We cannot find your current location. Please try again",d)}else{if(e.code===3){tfl.logs.create("tfl.geolocation.geolocateMe: ERROR: timeout");a.geolocationError("We cannot find your current location. Please try again",d)}}}}else{a.geolocationError("We cannot find your current location. Please try again",d)}};try{navigator.geolocation.getCurrentPosition(h,f,{timeout:a.geolocationTimeout})}catch(c){a.geolocationError("Your device does not support the location feature",d)}};a.geolocationError=function(c,b){$(".geolocation-error").text(c).removeClass("hidden");b.attr("placeholder",b.originalPlaceholder)};a.clearGeolocationError=function(){$(".geolocation-error").addClass("hidden")};a.setupInputBoxForGeolocation=function(b){var c=[9,16,17,18,19,20,33,34,35,36,37,38,39,40,45,46,91,92,93,112,113,114,115,116,117,118,119,120,121,122,123,144,145];var d=b.parent();d.attr("data-current-location","true");d.addClass("geocoded");b.typeahead("setQuery",tfl.dictionary.CurrentLocationText);b.on("keydown",function(f){if(c.indexOf(f.keyCode)>-1){return}if(d.attr("data-current-location")){d.removeAttr("data-current-location");d.removeClass("geocoded");b.typeahead("setQuery","");$(b.selector+"Geolocation").val("")}})}}(window.tfl.geolocation=window.tfl.geolocation||{}));window.tfl.autocomplete=window.tfl.autocomplete||{};(function(d){tfl.logs.create("tfl.autocomplete.sources: loaded");d.autocompleteDisplayNumberLimit=10;d.stationsStopsSelectionCallback=function(j,g){var h=$(j);var e=g.a||g.placeId;h.attr("data-"+h.attr("id").toLowerCase()+"-id",e);var f=JSON.stringify(g.c?g.c:g.placeModes);h.attr("data-"+h.attr("id").toLowerCase()+"-modes",f)};d.stationsStopsRemoveContent=function(f){var e=$(f);e.removeAttr("data-"+e.attr("id").toLowerCase()+"-id");e.removeAttr("data-"+e.attr("id").toLowerCase()+"-modes")};function a(e,f){if(e.a.length<f.a.length){return -1}if(e.a.length>f.a.length){return 1}return 0}d.geoCallback=function(){};var c="geolocation";var b="Use my location";d.geolocation={name:c,local:[{value:b,dataset:c}],valueKey:"value",minLength:0,limit:1,template:"<a class='geolocation-link' href='javascript:void(0)'><span class='geolocation-icon'>&nbsp</span>{{value}}</a>",engine:Hogan,footer:"<span class='source-footer'>&nbsp</span>"};d.geoLocation={name:c,local:[{value:b,dataset:c}],prefetch:"",remote:"",valueKey:"value",minLength:0,limit:1,template:"<a class='geolocation-link' href='javascript:void(0)'><span class='geolocation-icon'>&nbsp</span>{{value}}</a>",engine:Hogan,header:"",footer:"<span class='source-footer'>&nbsp</span>",callback:function(e){$(e).removeAttr("data-dataset-name");d.stationsStopsRemoveContent(e);tfl.geolocation.geolocateMe(e,d.geoCallback)}};d.getRecentSearches=function(g,f,e,h){return{callback:e,engine:Hogan,footer:"<span class='source-footer'>&nbsp</span>",header:"<span class='source-header'>Recent searches</span>",limit:5,local:f,minLength:0,name:g,template:h,valueKey:"name"}};d.recentSearches={engine:Hogan,footer:"<span class='source-footer'>&nbsp</span>",header:"<span class='source-header'>Recent searches</span>",limit:5,minLength:0,name:"recent-searches",valueKey:"name"};d.getTurnOnOffRecentSearches=function(f,e){e[0].dataset=f?"recent-searches-footer-on":"recent-searches-footer-off";return{engine:Hogan,footer:"<span class='source-footer'>&nbsp</span>",limit:1,local:e,minLength:0,name:f?"recent-searches-footer-on":"recent-searches-footer-off",template:"<span class='recent-searches-on-off-footer'><a href='javascript:void(0)'>{{linkText}}</a></span>",valueKey:"linkText"}};d.journeyPlannerSuggestions={name:"journey-planner-suggestions",local:"",prefetch:{url:"../cdn/static/feed/stations-list_typeahead.json",ttl:2629740000},remote:"",valueKey:"b",minLength:1,limit:d.autocompleteDisplayNumberLimit,template:"<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name'>{{b}}</span>",engine:Hogan,header:"",footer:"",callback:d.stationsStopsSelectionCallback,removeContent:d.stationsStopsRemoveContent};d.routesSearchFactory=function(f,e,g){return{name:"routes-search",local:"",prefetch:"",remote:{url:tfl.addAppIdAndKey(tfl.api.RoutesSearch.format(f)),cache:true,replace:function(k,j){var h=g==null?new RegExp("[^a-zA-Z0-9 /().']","g"):new RegExp(g,"g");return k.replace("%QUERY",decodeURIComponent(j).replace(h,""))},filter:function(j){var k=[];var m=j.searchMatches;for(var h=0;h<m.length;h++){var l=m[h];if(l.mode===tfl.modeNameTube){l.cssClass=l.lineName.indexOf(" ")!=-1?l.lineName.substring(0,l.lineName.indexOf(" ")).toLowerCase():l.lineName.toLowerCase()}else{l.cssClass=""}k.push({a:l.lineName+(l.mode==tfl.modeNameTube?" line":""),b:l.lineId,c:l.mode,f:l.cssClass});k.sort(a)}return k}},valueKey:"a",template:"<span class='mode-icon {{c}}-icon'>&nbsp;<span class='{{f}}'>&nbsp;</span></span><span class='stop-name' data-id='{{b}}'>{{a}}</span>",engine:Hogan,minLength:1,limit:10,header:"",footer:"",callback:e}};d.stopPointsSearchFactory=function(g,e,f,j,h){j=j!=true?false:true;if(h==null){h="stop-points-search"}return{name:h,local:"",prefetch:"",remote:{url:tfl.addAppIdAndKey(tfl.api.StopPointsSearch.format(g,j)),cache:true,replace:function(m,l){var k=new RegExp("[^a-zA-Z0-9 &-/().']","g");return m.replace("%QUERY",decodeURIComponent(l).replace(k,""))},filter:function(n){function m(s,t){var u=t.c.length-s.c.length;if(u===0){return s.a>t.a?1:-1}else{return u}}function l(t,u){for(var s=0;s<u.length;s++){if(u[s].id==t.parentId){return false}}return true}function r(s){if(s.modes&&s.modes.length>2){return false}else{return true}}var q=n.matches;var o=[];for(var k=0;k<q.length;k++){var p=q[k];if(f){if(r(p)){o.push({a:p.name,b:p.id,c:p.modes,d:p.lat,e:p.lon})}}else{if(l(p,q)){o.push({a:p.name,b:p.id,c:p.modes,d:p.lat,e:p.lon})}}}o.sort(m);return o}},valueKey:"a",template:"<div class='mode-icons'>{{#c}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/c}}</div><span class='stop-name' data-id='{{b}}'>{{a}}</span>",engine:Hogan,minLength:3,limit:10,header:"",footer:"",callback:e}}})(window.tfl.autocomplete.sources=window.tfl.autocomplete.sources||{});(function(a){tfl.logs.create("tfl.autocomplete: loaded");a.ClearSearchBox="clear-search-box";a.setup=function(e,c,b){var d=$(e);if($("html").hasClass("lt-ie8")){return}$(c).each(function(){if(this.remote&&this.remote.filter&&this.remote.replace){var h=this.remote.replace;var j=function(l,k){d.parent(".twitter-typeahead").addClass("downloading");return h(l,k)};this.remote.replace=j;var g=this.remote.filter;var f=function(k){d.parent(".twitter-typeahead").removeClass("downloading");return g(k)};this.remote.filter=f}});tfl.logs.create("tfl.autocomplete.setup: started");d.typeahead(c).on("keydown.autocomplete",function(h){var f=d.attr("data-dataset-name");if(f){for(var j=0;j<c.length;j++){var g=c[j];if(f===g.name){if(c[j].keydown){c[j].keydown(h,e)}break}}}}).on("typeahead:selected typeahead:autocompleted",function(j,h,f){if(f){for(var k=0;k<c.length;k++){var g=c[k];if(f===g.name){if(g.callback){g.callback(e,h,f)}if(g.contextCallback){g.contextCallback(e,h,f)}break}}d.attr("data-dataset-name",f)}}).parent().siblings(tfl.dictionary.RemoveContentClass).bind(a.ClearSearchBox,function(){$(this).click()});if(b){d.parent().siblings(tfl.dictionary.RemoveContentClass).click(function(){var f=d.attr("data-dataset-name");if(f){for(var h=0;h<c.length;h++){var g=c[h];if(f===g.name){if(c[h].removeContent){c[h].removeContent(d)}break}}d.removeAttr("data-dataset-name")}d.typeahead("setQuery","")})}};a.tokenize=function(q,u){var k=["'","(","&","-"];for(var f=0;f<q.length;f++){var n=q[f];var p=n[u].trim().split(" ");var s=p;var v=false;for(var h=0;h<p.length;h++){var o=p[h];for(var j=0;j<k.length;j++){var w=k[j];if(o.indexOf(w)!==-1){s.push.apply(s,o.trim().split(w));v=true}}}if(v&&s.length>0){var l=[];for(var m=0;m<s.length;m++){var g=true;var r=s[m];if(s.length>=m+1&&s[m+1]==="s"){r+="s"}for(var t=0;t<l.length;t++){if(r===l[t]){g=false;break}}if(r!=="s"&&r!==""&&g){l.push(r)}}if(l.length>0){n.tokens=l}}}return q};a.addBlankTokens=function(c){for(var b=0;b<c.length;b++){c[b].tokens=[]}return c}})(window.tfl.autocomplete=window.tfl.autocomplete||{});window.tfl.autocomplete=window.tfl.autocomplete||{};(function(a){tfl.logs.create("tfl.autocomplete.recentMagicSearches: loaded");a.searches={};a.usingRecentSearches=tfl.storage.get("usingRecentMagicSearches",true);a.isLoaded=false;a.recentSearchNumberLimit=5;a.recentSearchTimeLimit=2629740000;a.useRecentSearches=function(b){a.usingRecentSearches=b;tfl.storage.set("usingRecentMagicSearches",a.usingRecentSearches);a.searches={};tfl.storage.set("recentMagicSearches",a.searches);return false};a.loadSearches=function(){tfl.logs.create("tfl.autocomplete.recentMagicSearches.loadSearches: initialised");if(!a.isLoaded){if(a.usingRecentSearches){a.searches=tfl.storage.get("recentMagicSearches",{});var f=new Date().getTime();var d;for(var g in a.searches){if(a.searches.hasOwnProperty(g)){for(var e in a.searches[g]){if(a.searches[g].hasOwnProperty(e)){for(var b=0;b<a.searches[g][e].length;b++){if(a.searches[g][e][b]!==undefined){var c=a.searches[g][e][b];if(!c.hasOwnProperty("lastSearchDate")||c.lastSearchDate<(f-a.recentSearchTimeLimit)){tfl.logs.create("tfl.autocomplete.recentMagicSearches: removing old searches");a.searches[g][e].splice(b,1);d=true}}}}}}}if(d){tfl.storage.set("recentMagicSearches",a.searches)}}a.isLoaded=true}};a.saveSearch=function(o,k,n,q,g,j,f){tfl.logs.create("tfl.autocomplete.recentMagicSearches.saveSearch: initialised");a.loadSearches();if(o===""){return true}if(k===null){k=""}if(f===null){f=""}if(typeof n=="string"&&n!==""){n=jQuery.parseJSON(n)}if(n===null){n=[]}var s=new Date().getTime();if(q=="lines"){var m=n[0].toString();if(a.searches[q]){if(a.searches[q][m]){for(var d=0;d<a.searches[q][m].length;d++){var h=a.searches[q][m][d];if(h.id.toLowerCase()==k.toLowerCase()){a.searches[q][m].splice(d,1);break}}}else{a.searches[q][m]=[]}}else{a.searches[q]={};a.searches[q][m]=[]}var l={lastSearchDate:s,name:o,id:k,mode:m,cssClass:f,type:q};a.searches[q][m].splice(0,0,l);if(a.searches[q][m].length>a.recentSearchNumberLimit){a.searches[q][m].length=a.recentSearchNumberLimit}}else{if(q=="stops"){if(a.searches[q]){for(var e=0;e<a.searches[q].length;e++){var r=a.searches[q][e];if(r.id.toLowerCase()==k.toLowerCase()){a.searches[q].splice(e,1);break}}}else{a.searches[q]=[]}var p={lastSearchDate:s,name:o,id:k,modes:n,lat:g,lon:j,type:q};a.searches[q].splice(0,0,p);if(a.searches[q].length>a.recentSearchNumberLimit){a.searches[q].length=a.recentSearchNumberLimit}}}tfl.storage.set("recentMagicSearches",a.searches);return true};a.geolocateMe=function(h,b){var g=function(e){$(".geolocation-error").text(e).removeClass("hidden")};tfl.logs.create("tfl.autocomplete.recentMagicSearches.geolocateMe: initialised");var d=$(h);d.typeahead("setQuery","");d.attr("placeholder","Finding address...");var j=function(e){if(e.coords&&e.coords.accuracy&&e.coords.accuracy>1000000){tfl.logs.create("tfl.journeyPlanner.searchForm.geolocate me: ERROR: inaccuracy too high: "+e.coords.accuracy+"m");g("We cannot find your current location. Please try again");return}d.val(e.coords.longitude+","+e.coords.latitude);$(h).append("<input type='hidden' id='lat' name='lat' value='"+e.coords.latitude+"' />");$(h).append("<input type='hidden' id='lon' name='lon' value='"+e.coords.longitude+"' />");if(b){b()}};var f=function(e){if(e.code){if(e.code===1){tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: permission denied");g("Permission from browser needed before finding your location")}else{if(e.code===2){tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: position unavailable");g("We cannot find your current location. Please try again")}else{if(e.code===3){tfl.logs.create("tfl.journeyPlanner.searchForm.geolocateMe: ERROR: timeout");g("We cannot find your current location. Please try again")}}}}else{g("We cannot find your current location. Please try again")}};try{navigator.geolocation.getCurrentPosition(j,f)}catch(c){g("Your device does not support the location feature")}};a.test=function(){a.saveSearch("211","502",["bus"],"lines");a.saveSearch("36","609",["bus"],"lines");a.saveSearch("Emirates Greenwich Peninsula (Air Line Terminal)","9400ZZALGWP1",["cable-car"],"stops");a.saveSearch("Victoria Underground Station","9400ZZLUVIC1",["tube"],"stops");a.saveSearch("Southwark Underground Station","9400ZZLUSWK1",["tube"],"stops")}})(window.tfl.autocomplete.recentMagicSearches=window.tfl.autocomplete.recentMagicSearches||{});(function(c){var b="data-highlight-image";var a="data-highlight-file";c.init=function(){var f="no-background-image";var e=$("["+b+"]");e.push($("["+a+"]"));var d=[];$(window).one("enterBreakpointMedium",function(){$.each(e,function(m,q){var o=$(q),l=$(o.attr("data-highlight-for"));d.push(l);if(o.attr(b)){l.attr("style","background-image: url("+o.attr(b)+")")}else{if(o.attr(a)){tfl.ajax({url:o.attr(a),success:p})}}function p(s){var k=$.grep(s,function(u){return u.active});var t=k[Math.floor(Math.random()*(k.length))];l.attr("style","background-image: url("+t.backgroundImage+")");var r=l.find(".advert-link-box").attr("href",t.link).show();r.find("h2").text(t.headline);r.find("p").text(t.text);r.find("img").attr("src",t.imageURL)}var n=o.clone();n.find("img").each(function(){$(this).remove()});l.find(".content-area").append(n);o.addClass(o.attr("data-highlight-size"));var g=o.find(".caption");if(g){if(g.parent().hasClass("small")){var h=l.find(".content-area.medium-large");h.addClass("no-caption");var j=Math.max(415,l.find(".hero-row").height());h.find(".advert-tile").css({height:j+"px"})}}})});$(window).bind("exitBreakpointMedium",function(){$.each(d,function(g,h){$(h).addClass(f)})});$(window).bind("enterBreakpointMedium",function(){$.each(d,function(g,h){$(h).removeClass(f)})});if($("body.breakpoint-Medium").length>0){$(window).trigger("enterBreakpointMedium")}if($("body.breakpoint-Large").length>0){$(window).trigger("enterBreakpointLarge")}};c.init()}(window.tfl.heroTakeover=window.tfl.heroTakeover||{}));(function(c){tfl.logs.create("tfl.recent: loaded");var d=5;function f(g){return g.replace(/-([a-z])/g,function(h){return h[1]!==undefined?h[1].toUpperCase():h[1]})}function b(){var g;c.values={};for(g=0;g<tfl.objects.modes.length;g+=1){c.values[f(tfl.objects.modes[g])]=[]}}function e(){var h=tfl.storage.get("recent");if(h!=null){for(var g in h){if(h.hasOwnProperty(g)){if(!c.values.hasOwnProperty(g)){delete h[g]}}}c.values=$.extend(c.values,h)}}c.saveRecent=function(){tfl.storage.set("recent",c.values)};Array.prototype.remove=function(g,j){var h=this.slice((j||g)+1||this.length);this.length=g<0?this.length+g:g;return this.push.apply(this,h)};c.addRecent=function(j){if(typeof(j)!=="object"||!j.hasOwnProperty("mode")||j.mode===""||!j.hasOwnProperty("naptanId")||j.naptanId===""){tfl.logs.create("Add recent expects object defined in tfl.objects");return false}else{var g=false;for(var h=0;h<c.values[f(j.mode)].length;h+=1){if(c.values[f(j.mode)][h].naptanId===j.naptanId){g=true;c.values[f(j.mode)].remove(h);c.values[f(j.mode)].unshift(j);break}}if(!g){c.values[f(j.mode)].unshift(j);if(c.values[f(j.mode)].length>d){c.values[f(j.mode)].remove(d)}}c.saveRecent();return true}};c.getRecent=function(j){if(typeof(j)==="string"){for(var h in c.values){if(c.values.hasOwnProperty(h)){for(var g=0;g<c.values[h].length;g+=1){if(c.values[h][g].naptanId===j){return c.values[h][g]}}}}}else{tfl.logs.create("Error in tfl.favourites.getRecent - Expected naptanId");return false}return false};c.getRecentArray=function(g){var h=[];if(c.values.hasOwnProperty(g)){h=c.values[g]}else{for(var g in c.values){if(c.values.hasOwnProperty(g)){h=h.concat(tfl.recent.values[g])}}}return h};c.removeRecent=function(j){if(typeof(j)==="string"||typeof(j)==="number"){for(var h in c.values){if(c.values.hasOwnProperty(h)){for(var g=0;g<c.values[h].length;g+=1){if(c.values[h][g].naptanId===j){delete c.values[h][g]}}}}}else{tfl.logs.create("Error in tfl.recent.removeRecent - Expected naptanId");return false}c.saveRecent();return true};c.clearRecent=function(){b();c.saveRecent()};function a(){if(tfl.storage.isLocalStorageSupported()){b();e()}tfl.logs.create("tfl.recent: setup")}a()})(window.tfl.recent=window.tfl.recent||{});(function(f){tfl.logs.create("tfl.favourites: loaded");var b={};function h(j){return j.replace(/-([a-z])/g,function(k){return k[1]!==undefined?k[1].toUpperCase():k[1]})}function d(){var j;f.values={};for(j=0;j<tfl.objects.modes.length;j+=1){f.values[h(tfl.objects.modes[j])]={}}}function g(){var j=tfl.storage.get("favourites");if(j!=null){for(var k in j){if(j.hasOwnProperty(k)){if(!f.values.hasOwnProperty(k)){delete j[k]}}}f.values=$.extend(f.values,j)}}f.saveFavourites=function(){tfl.storage.set("favourites",f.values)};f.addFavourite=function(k){if(typeof(k)!=="object"||!k.hasOwnProperty("mode")||k.mode===""||!k.hasOwnProperty("naptanId")||k.naptanId===""){tfl.logs.create("Add Favourite expects object defined in tfl.objects");return false}else{f.values[h(k.mode)][k.naptanId]=k;f.saveFavourites();if(b.hasOwnProperty(k.naptanId)){for(var j=0;j<b[k.naptanId].dom.length;j+=1){b[k.naptanId].dom[j].addClass("active")}}return true}};f.getFavourite=function(j){if(typeof(j)==="string"){for(mode in f.values){if(f.values.hasOwnProperty(mode)){if(f.values[mode][j]!==undefined){return f.values[mode][j]}}}}else{tfl.logs.create("Error in tfl.favourites.getFavourite - Expected naptanId");return false}return false};f.getFavouritesArray=function(j){var k=[];if(f.values.hasOwnProperty(j)){for(var l in f.values[j]){if(f.values[j].hasOwnProperty(l)){k.push(f.values[j][l])}}}else{for(var j in f.values){if(f.values.hasOwnProperty(j)){for(var l in f.values[j]){if(tfl.favourites.values[j].hasOwnProperty(l)){k.push(tfl.favourites.values[j][l])}}}}}return k};f.removeFavourite=function(l){if(typeof(l)==="string"||typeof(l)==="number"){for(var k in f.values){if(f.values.hasOwnProperty(k)){delete f.values[k][l]}}}else{tfl.logs.create("Error in tfl.favourites.removeFavourite - Expected naptanId");return false}f.saveFavourites();if(b.hasOwnProperty(l)){for(var j=0;j<b[l].dom.length;j+=1){b[l].dom[j].removeClass("active")}}return true};f.clearFavourites=function(){d();f.saveFavourites();for(var k in b){if(b.hasOwnProperty(k)){for(var j=0;j<b[k].dom.length;j+=1){b[k].dom[j].removeClass("active")}}}};function a(j,k){var l=k?"active":"";j.append('<a href="javascript:void(0)" class="plain-link with-icon favourite '+l+'"><span class="i favourite-icon"></span><span class="inactive">Add Favourite</span><span class="active">Favourited <span class="visually-hidden">Click to remove from favourites</span></span></a>');return j.find(">.favourite")}f.setupButtons=function(){var j=$("[data-favourite]"),k;j.each(function(){var m=$(this),n=m.data("favourite"),p=false,r,l,o;if(typeof(n)==="string"){var q=f.getFavourite(n);if(!q){m.removeAttr("data-favourite");tfl.logs.create("tfl.favourites: fail to set up button, string provided - doesnt match existing favourite");return true}p=true;r=q}else{if(typeof(n)!=="object"){m.removeAttr("data-favourite");tfl.logs.create("tfl.favourites: neither string nor object passed to setupButtons");return true}}if(!p){if(!n.hasOwnProperty("naptanId")||!n.hasOwnProperty("mode")){m.removeAttr("data-favourite");tfl.logs.create("tfl.favourites: object passed to setup button has no mode or naptanId");return true}r=new tfl.objects.SSPObject(n.naptanId,n.mode,n.props);if(r.hasOwnProperty("error")){m.removeAttr("data-favourite");tfl.logs.create("tfl.favourites: properties passed to setup button generate invalid SSPObject");return true}}l=a(m,f.values[h(r.mode)].hasOwnProperty(r.naptanId));if(!b.hasOwnProperty(r.naptanId)){b[r.naptanId]={data:r,dom:[l]}}else{if(p){b[r.naptanId].data=$.extend(r,b[r.naptanId].data)}else{b[r.naptanId].data=$.extend(b[r.naptanId].data,r)}b[r.naptanId].dom.push(l)}l.on("click",function(s){s.preventDefault();if($(this).hasClass("active")){f.removeFavourite(r.naptanId)}else{f.addFavourite(b[r.naptanId].data)}});o=m.data("favourite-class");if(o!==undefined){l.addClass(o)}m.parent().addClass("with-favourite");m.removeAttr("data-favourite");tfl.recent.addRecent(r)})};function e(j,q){var v=Hogan.compile(q);var n=f.getFavouritesArray(tfl.modeNameBus);var s=tfl.recent.getRecentArray(tfl.modeNameBus);function t(){var y=v.render({favourites:n,recent:s});j.append(y);f.setupButtons();if(n.length>5){tfl.navigation.pagination.setup(j.find(".favourite .bus-stops").parent(),".bus-stops",5,n.length)}if(s.length>5){tfl.navigation.pagination.setup(j.find(".recent .bus-stops").parent(),".bus-stops",5,s.length)}var w=j.find(".tabs-style-2 > li:not(.not-for-beta)");w.on("click",function(B){B.preventDefault();B.stopPropagation();var A=$(this);if(!A.hasClass("selected")){var z=A.parent().siblings();z.addClass("hidden");z.filter("."+A.data("target")).removeClass("hidden");A.addClass("selected").siblings(".selected").removeClass("selected")}});if(!$(q).find(".links-only").length){tfl.expandableBox.init();$(".close-status",j).on("click",function(){$(this).closest(".content.expanded").removeClass("expanded")})}}var m=n.concat(s);if(m.length){var r=m.length;var o=0;var k={};var l=[];for(var p=0;p<r;p+=1){l.push(m[p].naptanId)}var u=tfl.tools.getQueryStringParameter("startDate");if(u!==null){k.url=tfl.api.StopPointsDisruptionsTimePeriod.format(l.join(","),u,tfl.tools.getQueryStringParameter("endDate"))}else{k.url=tfl.api.StopPointsDisruptions.format(l.join(","))}k.success=function(A){for(var w=0;w<A.length;w+=1){if(A[w].affectedStops!=null){for(var y=0;y<A[w].affectedStops.length;y+=1){favs:for(var z=0;z<n.length;z+=1){if(n[z].naptanId===A[w].affectedStops[y].id){n[z].props.disrupted="disrupted";if(!n[z].props.hasOwnProperty("disruptionInfo")){n[z].props.disruptionInfo=""}n[z].props.disruptionInfo+="<p>"+A[w].description+"</p>";break favs}}rec:for(var z=0;z<s.length;z+=1){if(s[z].naptanId===A[w].affectedStops[y].id){s[z].props.disrupted="disrupted";if(!s[z].props.hasOwnProperty("disruptionInfo")){s[z].props.disruptionInfo=""}s[z].props.disruptionInfo+="<p>"+A[w].description+"</p>";break rec}}}}}t()};tfl.ajax(k)}}f.setupFavouritesAndRecent=function(k){var j=$(k.selector);if(j.length){tfl.ajax({url:"/static/"+tfl.settings.version+"/templates/"+k.markup+".html",success:function(l){e(j,l)},dataType:"html"})}};function c(){if(tfl.storage.isLocalStorageSupported()){d();g();f.setupButtons();f.setupFavouritesAndRecent({selector:".favourite-and-recent",markup:"favourite-and-recent-links"})}tfl.logs.create("tfl.favourites: setup")}c()})(window.tfl.favourites=window.tfl.favourites||{});(function(e){tfl.logs.create("tfl.navigation.pullContent: started");var d,b,a,f;e.dataAttr="data-pull-content";var c="data-pull-content-storage";e.pullContentHandler=function(j){j.preventDefault();f=$(this);var o=f.attr(c),n;if(o){n=tfl.storage.get(o);if(n){return false}else{tfl.storage.set(o,"true")}}var h=f.attr(e.dataAttr).split(","),p=f.attr("href"),m=f.attr("data-light-box-type"),l=parseInt(f.attr("data-light-box-min-width"),10);tfl.logs.create("tfl.navigation.pullContent: Clicked a pull link for "+p);if(!isNaN(l)&&l>$(window).width()){window.open(p,"_blank");return false}m=m===undefined?"alert":m;d.attr("data-type",m);var g=function(t){var r=$(t),q=false,u;for(var s=0;s<h.length;s++){$.each(r.find($.trim(h[s])),function(w,z){q=true;var y=$("<p></p>").append($(z)).html();b.append(y)})}if(!q){document.location.href=p;return true}a.focus();u=b.find(":tabbable");$(u[u.length-1]).addClass("light-box-last-tab-target").attr("data-jumpto",".close-light-box")};if(p.length>0){if(m==="image"){var k=new Image();k.src=p;k.alt=f.text();b.append(k);d.addClass("active");a.focus()}else{tfl.ajax({url:p,success:g,dataType:"text"});d.addClass("active")}}};e.initialised=false;e.init=function(){var h=$("["+e.dataAttr+"]");var g=function(j){d=$(j);a=d.find(".close-light-box");b=d.find(".content");d.on("click.lightBox",function(k){a.trigger("click.lightBox")});d.find(".content-wrap").on("click.lightBox",function(k){k.stopPropagation()});a.on("click.lightBox",function(){b.empty();d.removeClass("active");f.focus()});$(document.body).append(d);h.click(e.pullContentHandler);e.initialised=true;tfl.logs.create("tfl.navigation.pullContent: initialised")};if(h.length&&!e.initialised){tfl.ajax({url:"/static/"+tfl.settings.version+"/templates/light-box.html",success:g,dataType:"text"})}else{h.off("click").click(e.pullContentHandler)}};e.init()})(window.tfl.navigation=window.tfl.navigation||{});var tfl=tfl||{};(function(b){b.logs.create("tfl.serviceStatus: loaded");var a=function(f){var e=$(".rainbow-list-wrapper, .rainbow-board.roads");if(f.parent(".rainbow-list-item").hasClass("expandable")){var d=f.parent(".rainbow-list-item");if(!d.hasClass("expanded")){var c=d.data("line-id");$(".rainbow-list-item.expanded",e).removeClass("expanded");d.addClass("expanded");e.addClass("fade-to-black");if(b.hasOwnProperty("tubeMap")){b.tubeMap.zoomToLineId(c)}d.trigger("rainbow-list.expanded");window.location.hash=c}else{d.removeClass("expanded");e.removeClass("fade-to-black");if(b.hasOwnProperty("tubeMap")){b.tubeMap.resetToInitialView()}d.trigger("rainbow-list.collapsed");window.location.hash="-"}}};b.serviceStatus={initServiceBoardPage:function(){b.logs.create("tfl.serviceStatus: initialised");b.serviceStatus.serviceUpdatesBoard()},pageSetup:function(){var h=$(".rainbow-list-wrapper, .rainbow-board.roads");$(".lines-stations-tab li").click(function(){c($(this));h.removeClass("fade-to-black")});$(".lines-stations-tab .lines-tab").click(function(){b.serviceStatus.appendHashToDatePickerAnchors("")});$(".lines-stations-tab .stations-tab").click(function(){b.serviceStatus.appendHashToDatePickerAnchors("#stations-status")});var c=function(n){b.logs.create("tfl.serviceStatus: click on tab");if(n.hasClass("selected")){return}var j=$(".lines-status"),l=$(".stations-status"),k=$(".lines-tab"),m=$(".stations-tab");if(j.hasClass("visible")){j.removeClass("visible");l.addClass("visible");k.removeClass("selected");m.addClass("selected")}else{l.removeClass("visible");j.addClass("visible");m.removeClass("selected");k.addClass("selected")}};if(window.location.hash!==""){var f=window.location.hash;b.logs.create("tfl.serviceStatus: page hash is "+f);var g=f.substr(1);if(g==="stations-status"){$(".lines-stations-tab .stations-tab").click()}else{var d=$("[data-line-class="+g.toLowerCase()+"]");if(d.length>0){a(d)}else{var e=$("[data-station-class="+g.toLowerCase()+"]");if(e.length>0){c(stationsTab);a(e)}}}}},serviceUpdatesBoard:function(){var c=$(".rainbow-list-wrapper, .rainbow-board.roads");$(".close-disruption-info").click(function(){$(this).closest(".info-dropdown").prev().removeClass("selected");$(".rainbow-board").removeClass("fade-to-black")});$(".rainbow-list-content .close-message",c).on("click",function(d){d.preventDefault();$(this).closest(".rainbow-list-item").removeClass("expanded");c.removeClass("fade-to-black")});$("[data-line-class], [data-station-class]").click(function(d){a($(this));d.preventDefault();d.stopPropagation()})},updateServiceBoard:function(d,e){$("#"+d).parent().html(e);var c=$(".datepicker-dropdown.dropdown-button");if(c.length){b.serviceStatus.initServiceBoardPage();c.html(b.tools.getTime(new Date()))}},ajaxServiceBoard:function(c,d){b.ajax({url:c,success:function(e){b.serviceStatus.updateServiceBoard(d,e)},autoRefreshInterval:b.autoRefresh.ServiceBoard,autoRefreshId:d,dataType:"text"})},initServiceBoardAutoRefresh:function(f,g){var c=$("#"+g).parents(".expandable-box");if(c.length){var d=c.find(".always-visible");d.on("expandable-box.expanded",function(){b.serviceStatus.ajaxServiceBoard(f,g)});d.on("expandable-box.collapsed",function(){b.stopAjaxAutoRefresh(g)});var e=c.find(".content.expanded");if(e.length){b.serviceStatus.ajaxServiceBoard(f,g)}}else{window.setTimeout(function(){b.serviceStatus.ajaxServiceBoard(f,g)},b.autoRefresh.ServiceBoard)}},appendHashToDatePickerAnchors:function(c){if(window.location.hash!==""||c!==null){$(".datepicker-dropdown a").each(function(){var d=$(this).attr("href");d=d.indexOf("#")!==-1?d.substr(0,d.indexOf("#")):d;c=c!=null?c:window.location.hash;$(this).attr("href",d+c)})}}};b.serviceStatus.pageSetup()})(tfl);(function(a){tfl.logs.create("tfl.socialMedia: loaded");a.init=function(){var f=$(".share-widget-wrapper");if(f.length>0){var c=$(".section-overview");if(c.length>0&&!c.hasClass("full-width")){f.css({marginTop:0,display:"block",cssFloat:"none"})}f.append('<a href="javascript:void(0)" class="share-widget clearfix"><div class="twitter-icon icon"></div><div class="facebook-icon icon"></div><div class="share-icon icon"></div><span class="share-text">Share <span class="visually-hidden">on social media</span></span><span class="down-arrow icon"></span></a>');var e=window.location.href;var d=$("h1").text();var b=$('<ul class="share-list"></ul>');b.append('<li><a href="http://www.facebook.com/share.php?u='+e+"&t="+d+'" class="share-facebook clearfix" tabindex="0"><span class="facebook-icon icon"></span><span class="text">Facebook</span></a></li>');b.append('<li><a href="http://twitter.com/home?status='+d+" "+e+'" class="share-twitter clearfix" tabindex="0"><span class="twitter-icon icon"></span><span class="text">Twitter</span></a></li>');f.append(b);b.find("a").focus(function(){b.addClass("visible-for-focus")}).blur(function(){b.removeClass("visible-for-focus")});f.removeClass("hidden")}};a.init()}(window.tfl.socialMedia=window.tfl.socialMedia||{}));window.tfl.journeyPlanner=window.tfl.journeyPlanner||{};(function(a){tfl.logs.create("tfl.journeyPlanner.recentJourneys: loaded");a.journeys=[];a.usingRecentJourneys=tfl.storage.get("usingRecentJourneys",true);a.isLoaded=false;a.recentJourneyNumberLimit=5;a.loadJourneys=function(){if(!a.isLoaded){if(a.usingRecentJourneys){a.journeys=tfl.storage.get("recentJourneys",[])}a.isLoaded=true}};a.useJourneys=function(b){tfl.journeyPlanner.recentJourneys.usingRecentJourneys=b;tfl.storage.set("usingRecentJourneys",a.usingRecentJourneys);a.journeys=[];tfl.storage.set("recentJourneys",a.journeys);tfl.journeyPlanner.recentSearches.searches=[];tfl.storage.set("recentSearches",tfl.journeyPlanner.recentSearches.searches);return false};a.saveJourney=function(b,c,g,h,k,l){if($("#From").val()===tfl.dictionary.CurrentLocationText||$("#From").val()===tfl.dictionary.CurrentLocationText||$("#From").val()===tfl.dictionary.CurrentLocationText){return true}a.loadJourneys();var f={from:$("#From").val().replace(/^\s+|\s+$/g,""),fromId:b,fromModes:c?jQuery.parseJSON(c):"",to:$("#To").val().replace(/^\s+|\s+$/g,""),toId:g,toModes:h?jQuery.parseJSON(h):"",via:$("#Via").val().replace(/^\s+|\s+$/g,""),viaId:k,viaModes:l?jQuery.parseJSON(l):""};if(f.from===""||f.to===""){return true}for(var d=0;d<tfl.journeyPlanner.recentJourneys.journeys.length;d++){var e=tfl.journeyPlanner.recentJourneys.journeys[d];if(e.from.toLowerCase().replace(/ /g,"")===f.from.toLowerCase().replace(/ /g,"")&&e.to.toLowerCase().replace(/ /g,"")===f.to.toLowerCase().replace(/ /g,"")&&e.via.toLowerCase().replace(/ /g,"")===f.via.toLowerCase().replace(/ /g,"")){if(f.fromId==""&&e.fromId!==""){f.fromId=e.fromId}if(f.fromModes==""&&e.fromModes!==""){f.fromModes=e.fromModes}if(f.toId==""&&e.toId!==""){f.toId=e.toId}if(f.toModes==""&&e.toModes!==""){f.toModes=e.toModes}if(f.viaId==""&&e.viaId!==""){f.viaId=e.viaId}if(f.viaModes==""&&e.viaModes!==""){f.viaModes=e.viaModes}tfl.journeyPlanner.recentJourneys.journeys.splice(d,1);break}}tfl.journeyPlanner.recentJourneys.journeys.splice(0,0,f);if(tfl.journeyPlanner.recentJourneys.journeys.length>a.recentJourneyNumberLimit){tfl.journeyPlanner.recentJourneys.journeys.length=a.recentJourneyNumberLimit}tfl.storage.set("recentJourneys",tfl.journeyPlanner.recentJourneys.journeys);return true}})(window.tfl.journeyPlanner.recentJourneys=window.tfl.journeyPlanner.recentJourneys||{});window.tfl.journeyPlanner=window.tfl.journeyPlanner||{};(function(a){tfl.logs.create("tfl.journeyPlanner.recentSearches: loaded");a.searches=[];a.isLoaded=false;a.recentSearchNumberLimit=5;a.recentSearchTimeLimit=2629740000;a.loadSearches=function(){if(!a.isLoaded){if(tfl.journeyPlanner.recentJourneys.usingRecentJourneys){a.searches=tfl.storage.get("recentSearches",[]);if(a.searches.length>0){var d=new Date().getTime();for(var b=0;b<a.searches.length;b++){var c=a.searches[b];if(c.lastSearchDate<(d-a.recentSearchTimeLimit)){a.searches.splice(b,1)}}}}a.isLoaded=true}};a.saveSearch=function(f,d,e){if(f===""||f===tfl.dictionary.CurrentLocationText){return true}f=f.replace(/^\s+|\s+$/g,"");if(d===null){d=""}if(typeof e=="string"&&e!==""){e=jQuery.parseJSON(e)}var h=new Date().getTime();for(var b=0;b<tfl.journeyPlanner.recentSearches.searches.length;b++){var c=tfl.journeyPlanner.recentSearches.searches[b];if(c.placeName.toLowerCase()===f.toLowerCase()){if(d==""&&c.placeId!==""){d=c.placeId}if(e==""&&c.placeModes!==""){e=c.placeModes}tfl.journeyPlanner.recentSearches.searches.splice(b,1);break}}var g={placeName:f,placeId:d,placeModes:e,lastSearchDate:h};tfl.journeyPlanner.recentSearches.searches.splice(0,0,g);if(tfl.journeyPlanner.recentSearches.searches.length>a.recentSearchNumberLimit){tfl.journeyPlanner.recentSearches.searches.length=a.recentSearchNumberLimit}tfl.storage.set("recentSearches",tfl.journeyPlanner.recentSearches.searches);return true}})(window.tfl.journeyPlanner.recentSearches=window.tfl.journeyPlanner.recentSearches||{});(function(b){tfl.logs.create("tfl.journeyPlanner: loaded");tfl.cachingSettings={daily:a()};function a(){var c=new Date();var e=String(c.getFullYear())+String(c.getMonth())+String(c.getDay())+String(c.getHours());return e}b.settings={disambiguationItemsPerPage:9};b.init=function(){tfl.logs.create("tfl.journeyPlanner.init: started");b.createJourneys()};b.createJourneys=function(){if(!tfl.storage.isLocalStorageSupported()){tfl.logs.create("tfl.journeyplanner: Not creating recent journeys box - localStorage not present.");return}tfl.logs.create("tfl.journeyplanner: Creating recent journeys box");$("#recent-journeys").empty();if($("div[data-set=recent-journeys]").length===0){$("#more-journey-options").after("<div class='small' data-set='recent-journeys' />");$("#plan-a-journey").after("<div class='medium-large' data-set='recent-journeys'><div id='recent-journeys' class='moving-source-order' /></div>")}var d=$("#recent-journeys");d.empty();d.append("<h3>Recent journeys</h3>");if(!tfl.journeyPlanner.recentJourneys.usingRecentJourneys){d.append("<p>Turn on recent searches so you can access them easily again<br/><a href='javascript:void(0)' class='turn-on-recent-journeys' data-jumpback='#SavePreferences:visible' data-jumpto='#footer a:first'>Turn on recent journeys</a></p>")}else{tfl.journeyPlanner.recentJourneys.loadJourneys();if(tfl.journeyPlanner.recentJourneys.journeys.length>0){var c=$("<div class='vertical-button-container' />");$(tfl.journeyPlanner.recentJourneys.journeys).each(function(e){var g="<strong>"+this.from+"</strong> to <strong>"+this.to+"</strong>";if(this.via!==""){g+=" via <strong>"+this.via+"</strong>"}var f;if(e===0){f=$("<a href='javscript:void(0)' class='plain-button' data-jumpback='#SavePreferences:visible'>"+g+"</a>")}else{f=$("<a href='javscript:void(0)' class='plain-button'>"+g+"</a>")}f.click(function(){b.redoJourney(e);return false});c.append(f)});d.append(c);d.append("<p><a href='javascript:void(0)' class='turn-off-recent-journeys' data-jumpto='#footer a:first' data-jumpback='#SavePreferences:visible'>Turn off and clear recent journeys</a></p>")}else{d.append("<p>You currently have no saved journeys<br/><a href='javascript:void(0)' class='turn-off-recent-journeys' data-jumpto='#footer a:first' data-jumpback='#SavePreferences:visible'>Turn off recent journeys</a></p>")}}$("div.medium-large[data-set=recent-journeys]").append(d);$(".moving-source-order").appendAround();$(".turn-on-recent-journeys").click(function(e){e.preventDefault();tfl.journeyPlanner.recentJourneys.useJourneys(true);tfl.journeyPlanner.searchForm.destroyAutocomplete();tfl.journeyPlanner.searchForm.setupAutocomplete(false);if($("#recent-journeys").length!=0){b.createJourneys()}});$(".turn-off-recent-journeys").click(function(e){e.preventDefault();tfl.journeyPlanner.recentJourneys.useJourneys(false);tfl.journeyPlanner.searchForm.destroyAutocomplete();tfl.journeyPlanner.searchForm.setupAutocomplete(false);if($("#recent-journeys").length!=0){b.createJourneys()}})};b.redoJourney=function(e){var f=tfl.journeyPlanner.recentJourneys.journeys[e];var c=false;var d=function(){$("#jp-search-form").submit()};if(f.from===tfl.dictionary.CurrentLocationText){c=true;tfl.journeyPlanner.searchForm.geolocateMe("#From",d)}else{$("#From").val(f.from);$("#From").attr("data-from-id",f.fromId);$("#From").attr("data-from-modes",JSON.stringify(f.fromModes))}if(f.to===tfl.dictionary.CurrentLocationText){c=true;tfl.journeyPlanner.searchForm.geolocateMe("#To",d)}else{$("#To").val(f.to);$("#To").attr("data-to-id",f.toId);$("#To").attr("data-to-modes",JSON.stringify(f.toModes))}if(f.via!==null){if(f.via===tfl.dictionary.CurrentLocationText){c=true;tfl.journeyPlanner.searchForm.geolocateMe("#Via",d)}else{$("#Via").val(f.via);$("#Via").attr("data-via-id",f.viaId);$("#Via").attr("data-via-modes",JSON.stringify(f.viaModes))}}else{$("#Via").val("")}if(!c){d()}}})(window.tfl.journeyPlanner=window.tfl.journeyPlanner||{});(function(a){tfl.logs.create("tfl.journeyPlanner.results: loaded");a.init=function(b){tfl.logs.create("tfl.journeyPlanner.results.init: started (isAjax: "+b+")");if(!b){a.resultsFormInit();a.processResults();a.initSteal()}else{a.initAjaxPage()}if($("html").hasClass("lt-ie8")){a.initIE7()}};a.initGlobal=function(){tfl.logs.create("tfl.journeyPlanner.initGlobal: started");tfl.expandableBox.init()};a.initAjaxPage=function(){tfl.logs.create("tfl.journeyPlanner.results.initAjaxPage: started");var c=$("#JpType").val()==""?"publictransport":$("#JpType").val();a.setupLoader(c);a.resultsFormInit();var e=window.location.href,d=tfl.jPResultsPageUrl;e=e.substring(e.indexOf("?"),e.length);var b=function(h){data=$(h).find(".ajax-response");$(".journey-details-ajax").replaceWith($(data));var g=$(".walking-box .journey-time");if(g.length==1&&$('[data-jp-tabs="true"] .walking.selected').length<1){g.find(".visually-hidden").remove();g=$("<span></span>").addClass("tabs-time").text("Walk this in "+g.text());$('[data-jp-tabs="true"] [data-jptype="walking"]').addClass("has-time").append(g)}var f=$(".cycling-box .journey-time");if(f.length==1&&$('[data-jp-tabs="true"] .cycling.selected').length<1){f.find(".visually-hidden").remove();f=$("<span></span>").addClass("tabs-time").text("Cycle in "+f.text());$('[data-jp-tabs="true"] [data-jptype="cycling"]').addClass("has-time").append(f)}a.processResults();a.initGlobal();if($(".disambiguation-form").length>0){tfl.journeyPlanner.disambiguation.init()}else{$(".summary-results > .expandable-box").css({opacity:0}).each(function(j){$(this).delay(150*j).animate({opacity:1},100,function(){$(this).removeAttr("style")})})}a.initSteal();$("#alternatives").find("[data-pull-content]").click(tfl.navigation.pullContentHandler)};tfl.ajax({url:d+e+"&ispostback=true",success:b,dataType:"html"})};a.initSteal=function(){steal(tfl.mapScriptPath).then(function(){tfl.logs.create("tfl.journeyPlanner.results.initSteal: started");var e=false;var d=null;var c=null;function b(){tfl.fullscreen.display(d,false,true);d.controller().divResized()}$(".view-on-a-map").click(function(h,g){var f=$(this);$(".view-on-a-map").not(this).removeClass("show-all");f.toggleClass("show-all");var j;if(g&&g.isHideAll){j=$(".view-on-a-map.hide-map")}else{j=$(".view-on-a-map.hide-map").not(this)}j.text("View on a map").removeClass("hide-map");if(f.hasClass("hide-map")){f.text("View on a map").removeClass("hide-map");d.hide()}else{if(!e){f.after("<div id='leg_map' class='leg-map'></div>");$.fixture.on=false;d=$("#leg_map").tfl_maps_journey_planner_leg_map({url:$(".journey-results").data("api-uri"),isNationalBounds:tfl.getQueryParam("NationalSearch")==="true",mapDeactivated:function(){if(!$(document.body).hasClass("breakpoint-Medium")){tfl.fullscreen.hide()}d.siblings(".view-on-a-map").trigger("click")}});c=d.controller();c.mapLoading.done(function(){$(window).on("enterBreakpointSmall exitBreakpointMedium",function(){if(d.is(":visible")){b()}}).on("enterBreakpointMedium",function(){tfl.fullscreen.hide()});if(!$(document.body).hasClass("breakpoint-Medium")){b()}});e=true}else{d.show();d.insertAfter($(this));if(!$(document.body).hasClass("breakpoint-Medium")){b()}}c.chooseLeg(f.data("journeyindex"),f.data("legindex"));f.text("Hide map").addClass("hide-map")}h.preventDefault()})})};a.initIE7=function(){$(".cancel-button, .toggle-options, .edit-button").click(function(){var b=$(".journey-form").parents(".r").next();b.attr("class",b.attr("class"))})};a.maps=function(d){var b="cycling";var e="walking";if(d==b||d==e){var c=(d==b)?$(".summary-results.cycling .cycling-box"):$(".summary-results.walking .walking-box");if(c.length==1){c.find(".always-visible .show-detailed-results").click();a.triggerMapLink($(".full-results-container .view-on-a-map"))}}};a.triggerMapLink=function(b){tfl.logs.create("tfl.journeyPlanner.results: trigger click on map link");b.trigger("click",{isHideAll:true})};a.setupLoader=function(g){var b=$('<div id="loader-background"></div>');var c=$('<div id="loader-birds"></div>');var k=$('<div id="loader-trees"></div>');var l=$('<div class="tree-segment"></div>');var f;for(f=0;f<8;f++){k.append(l.clone())}var j=$('<div id="loader-transport-method"></div>');var d=$('<div id="loader-grass"></div>');var e=$('<div class="grass-segment"></div>');for(f=0;f<18;f++){d.append(e.clone())}var h=$('<div id="loader-message">Fetching results</div>');$("#loader-window").addClass(g).append(b).append(k).append(c).append(j).append(d).append(h)};a.processResults=function(){$(".summary-results > .expandable-box > .content > .always-visible").click(function(){if($(this).parents(".not-selected").length>0){a.unshowAllDetailedResults();a.currentlyShowing=null}});var l=$(".summary-results");if(l.hasClass("cycling")){a.maps("cycling")}else{if(l.hasClass("walking")){a.maps("walking")}}$(".always-visible .journey-price").after("<button class='primary-button show-detailed-results' data-jumpto=''>"+tfl.dictionary.ShowDetailedView+"</button>");$(".back-to-link").click(a.unshowAllDetailedResults);var d=1;if($(".journey-details").length>0){if(tfl.journeyPlanner.recentJourneys.usingRecentJourneys){tfl.journeyPlanner.recentJourneys.saveJourney($("#From").attr("data-from-id"),$("#From").attr("data-from-modes"),$("#To").attr("data-to-id"),$("#To").attr("data-to-modes"));tfl.journeyPlanner.recentSearches.saveSearch($("#From").val(),$("#From").attr("data-from-id"),$("#From").attr("data-from-modes"));tfl.journeyPlanner.recentSearches.saveSearch($("#To").val(),$("#To").attr("data-to-id"),$("#To").attr("data-to-modes"));if($("#Via").val()!==""){tfl.journeyPlanner.recentSearches.saveSearch($("#Via").val(),$("#Via").attr("data-via-id"),$("#Via").attr("data-via-modes"))}}}$(".journey-details").each(a.generateJourneySummary);var g=$(".journey-steps .message-toggle");var h=$(".journey-detail-step .line-status .message-toggle");var b;for(var e=0;e<g.length;e++){b=$(g[e]);(function(){var j=e;b.click(function(){if(!$(h[j]).parent().parent().hasClass("expanded")){$(h[j]).click()}$(this).parents(".summary").find(".show-detailed-results").click()})})()}$(".line-status-info .start-hidden");var c=$(".line-status-info .hide-link");for(var f=0;f<g.length;f++){b=$(c[f]);(function(){var j=f;b.click(function(){$(h[j]).click()})})()}$(".show-detailed-results").click(a.viewDetailsClick);a.expandableBoxes=$(".summary-results > .expandable-box");$(".json-all-stops").click(a.showAllStops);$(".text-instructions-link").click(a.showTextInstructions);$(".disruption-heading").append('<span class="link-style show-details">Show details...</span><span class="link-style hide-details">Hide details...</span>');$(".accessibility-details").append('<div class="show-hide-links"><a href="javascript:void(0)" class="show-link">Show details...</a><a href="javascript:void(0)" class="hide-link">Hide details...</a></div>');$(".show-hide-links a").click(function(j){$(".accessibility-details").toggleClass("expanded");j.preventDefault()});$(".journey-detail-step.terminus").after("<div class='jp-print-button clearfix'><a href='javascript:window.print()' class='secondary-button print-button'>Print this route</a></div>")};a.generateJourneySummary=function(){var b=$("<table></table>").attr("class","journey-steps").append("<caption class='visually-hidden'>Steps for journey option "+i+"</caption><thead><tr><th>Time</th><th>Mode of Transport</th><th>Instructions</th></tr></thead>");$(this).find(".journey-detail-step:not(.terminus)").each(function(e){var d="";var h=$(this).find(".step-heading .time-and-mode .centred").html();var j=$("<tr></tr>");var f=false;if($(this).find(".details .instructions .line-status").length>0){f=true}var c="time";if($(this).find(".duration").text().indexOf("hour")>0){c=c+" wide"}j.append("<td class='"+c+"'><strong>"+$(this).find(".duration").text().replace("minute","min").replace("hour","hr")+"</strong></td>");var g=f?$("<td class='logo disrupted'></td>"):$("<td class='logo'></td>");g.append($(this).find(".time-and-mode .centred").clone());j.append(g);if(f){j.append("<td class='description disrupted'>"+$(this).find(".step-summary").html()+"</td>")}else{j.append("<td class='description'>"+$(this).find(".step-summary").html()+"</td>")}b.append(j);if($(this).find(".line-status").length>0){var k=$("<td class='disrupted'></td>").append($(this).find(".disruption-messages .line-status .message-toggle").eq(0).clone());b.append($("<tr><td class='time'>&nbsp;</td><td class='logo disrupted'><div class='disruption-icon centred hide-text'>Disruption</div></td></tr>").append(k))}});b.insertBefore(this);b.after($(this).parents(".content").find(".price-and-details").clone());i++};a.viewDetailsClick=function(b){b.stopPropagation();var c=0;c=$.inArray($(this).parents(".expandable-box").get(0),a.expandableBoxes);a.unshowAllDetailedResults();tfl.logs.create("tfl.journeyPlanner.results: view details clicked: (index: "+c+", currentlyshowing: "+a.currentlyShowing+")");if(c!=a.currentlyShowing){a.showDetailedResults(c)}else{a.currentlyShowing=null}return false};a.showDetailedResults=function(g){tfl.logs.create("tfl.journeyPlanner.results: Show detailed results. Index: "+g);var e=a.expandableBoxes;a.currentlyShowing=g;e.removeClass("selected").addClass("not-selected");var l=$(e[g]);var k=$(e[g+1]);var h=$(e[e.length-1]);$(h).find(".show-detailed-results").attr("data-jumpto",".earlier:tabbable:first");$(h).find(".show-detailed-results").addClass("last-show-details");l.removeClass("not-selected").addClass("selected");var j=l.find(".show-detailed-results:visible");$(".show-detailed-results").text(tfl.dictionary.ShowDetailedView);$(l).find(".show-detailed-results").text(tfl.dictionary.HideDetailedView);$(l).find(".show-detailed-results").addClass("hide-details");$(k).find(".show-detailed-results").addClass("next-show-details");$(l).find(".show-detailed-results").attr("data-jumpto",".journey-details :tabbable:first:visible");$(l).find(".show-detailed-results").removeClass("last-show-details");$(e[a.currentlyShowing]).children(".content").children(".start-hidden").appendTo(".full-results-container");$(".replan-route").remove();$(".full-results-container").append("<div class='replan-route'><a href='javascript:void(0)' class='replan-from-current-location' data-jumpto='.next-show-details:visible'>Replan route from current location</a></div>");$(".replan-from-current-location").click(function(){tfl.geolocation.geolocateMe("#From",function(){var n=$("#From");n.removeAttr("data-from-id");n.removeAttr("data-from-modes");n.removeAttr("data-dataset-name");$("#jp-search-form").submit()});$(".secondary-button.edit-button").click();return false});$(".full-results-container").removeClass("hidden").addClass($("#JpType").val());$(document.body).addClass("showing-full-details");var d=$(".full-results-container").offset().top;$("html, body").animate({scrollTop:d-10});$(".journey-details :tabbable:first").focus();var f=$(".full-results-container");var m=f.find(".journey-detail-step");if(!$("html").hasClass("breakpoint-Medium")){if(history.pushState){var c=$(".back-to-link");var b=function(){window.onpopstate=null;history.go(-1);c.off("click",this)};history.pushState({},null);c.on("click",b);window.onpopstate=function(){a.unshowAllDetailedResults();window.onpopstate=null}}}return false};a.unshowAllDetailedResults=function(){tfl.logs.create("tfl.journeyPlanner.results: Unshow all detailed results.");var b=a.expandableBoxes;$(".full-results-container").addClass("hidden");$(".full-results-container > .start-hidden").appendTo($(b[a.currentlyShowing]).children(".content"));$(".show-detailed-results").text(tfl.dictionary.ShowDetailedView);$(".show-detailed-results").removeClass("hide-details");$(".show-detailed-results").removeClass("next-show-details");$(".show-detailed-results").attr("data-jumpto","");b.removeClass("not-selected selected");$(document.body).removeClass("showing-full-details");$(".json-all-stops").text(tfl.dictionary.ShowAllStops);$(".json-all-stops").parent().siblings(".all-stops").hide();$(".text-instructions-link").text(tfl.dictionary.ShowTextInstructions).removeClass("hide");$(".details .text-instructions-list").hide();return false};a.showAllStops=function(){var b=this;if($(b).text()==tfl.dictionary.ShowAllStops){$(b).text(tfl.dictionary.HideAllStops);$(b).parent().siblings(".all-stops").show()}else{$(b).text(tfl.dictionary.ShowAllStops);$(b).parent().siblings(".all-stops").hide()}$(b).toggleClass("hide");return false};a.showTextInstructions=function(){var c=$(this);var b=c.parent().siblings(".text-instructions-list");if(c.text()==tfl.dictionary.ShowTextInstructions){c.text(tfl.dictionary.HideTextInstructions);b.show()}else{c.text(tfl.dictionary.ShowTextInstructions);b.hide()}c.toggleClass("hide");return false};a.resultsFormInit=function(){tfl.logs.create("tfl.journeyPlanner.results: resultsFormInit started");$(".plan-journey-button").wrap("<div class='clearfix update-buttons' />").before("<input type='button' class='secondary-button cancel-button' value='Cancel' />");$(".plan-journey-button").val("Update journey").submit(function(){$(".cancel-button").remove()});$(".plan-journey-button-second").val("Update journey");tfl.journeyPlanner.searchForm.buildSwitchButton();$(".switch-button").click(tfl.journeyPlanner.searchForm.switchFromTo);var h=tfl.utils.isTouchDevice();if($("#From").val()!==""&&$("#To").val()!==""){var s="";if(h){s=" touch"}var j=$("<div class='journey-result-summary"+s+"' ><div class='from-to-wrapper'></div></div>");j.children(".from-to-wrapper").append("<div class='summary-row clearfix'><span class='label'>From:</span><strong>"+$("#From").val()+"</strong></div>");j.children(".from-to-wrapper").append("<div class='summary-row clearfix'><span class='label'>To:</span><strong>"+$("#To").val()+"</strong></div>");var k=$(".leaving-or-arriving li.selected").text().replace(/^\s+|\s+$/g,"");var c=$("#Date").val();if(c!==null){var m=parseInt(c.substring(4,6),10);m--;c=new Date(parseInt(c.substring(0,4),10),m,parseInt(c.substring(6,8),10))}else{c=new Date()}var n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var p="<sup>th</sup>";var d=c.getDate();var l=d%10;if(l===1&&d!==11){p="<sup>st</sup>"}else{if(l===2&&d!==12){p="<sup>nd</sup>"}else{if(l===3&&d!==13){p="<sup>rd</sup>"}}}var r=e[c.getDay()]+" "+c.getDate()+p+" "+n[c.getMonth()];r+=", "+$("#Time option:selected").text();var t="";var v=$("#Via").val();if(v!==""){t+="<strong class='via-destination'>Via "+v+"</strong> "}var q=$(".jp-mode-cycling .accessibility-options .ticked label").html();t+='<strong class="travelpreferences-cycling">'+q+"</strong>";var o=$("#WalkingSpeed :selected").text();t+='<strong class="travelpreferences-walking">'+o+" walking speed</strong>";t+='<strong class="travelpreferences-publictransport">Showing '+$("#JourneyPreference option:selected").text().toLowerCase()+"</strong> ";var u=$(".modes-of-transport option:selected");t+='<strong class="travelpreferences-publictransport">Using ';var g=0;if($(".modes-of-transport option:not(:selected)").length===0){t+="all transport modes"}else{if(u.length<=4){for(g=0;g<u.length;g++){if(g>0&&g===u.length-1){t+=" and "}else{if(g>0){t+=", "}}t+=$(u[g]).text().replace(/^\s+|\s+$/g,"")}}else{for(g=0;g<3;g++){if(g>0){t+=", "}t+=$(u[g]).text().replace(/^\s+|\s+$/g,"")}t+=" and "+(u.length-3)+" others"}}t+="</strong> ";var b=$(".accessibility-options li.ticked input").val();if(b&&b!==""&&b.toLowerCase()!=="norequirements"){t+='<strong class="travelpreferences-publictransport">Step free access required</strong> '}t+='<strong class="travelpreferences-publictransport">Max walk time '+$("#MaxWalkingMinutes").val()+" mins</strong>";j.append("<div class='summary-row clearfix'><span class='label'>"+k+":</span><strong>"+r+"</strong></div>");var f=$("<button></button>").addClass("secondary-button edit-button").text("Edit").click(function(w){w.preventDefault();$("#plan-a-journey").addClass("editing");$("#plan-a-journey :tabbable:first:visible").focus();$("#From, #To, #Via").trigger("change")});j.append($("<div></div>").addClass("summary-row").append(f));j.append("<div class='travel-preferences clearfix'><div class='left-shadow' /><div class='scroller'><div><span>Travel preferences: </span>"+t+"</div></div><div class='right-shadow' /></div>");$("#plan-a-journey").append(j)}if(h){tfl.journeyPlanner.travelPrefsInnerWidth=$(".scroller > div").get(0).scrollWidth;tfl.journeyPlanner.travelPrefsScrollMax=tfl.journeyPlanner.travelPrefsInnerWidth-$(".scroller").width();tfl.journeyPlanner.travelPrefsLeftShadow=$(".left-shadow");tfl.journeyPlanner.travelPrefsRightShadow=$(".right-shadow");$(".scroller").scroll(function(){var w=$(this).scrollLeft();tfl.journeyPlanner.travelPrefsLeftShadow.css({left:Math.min(0,-40+w)});tfl.journeyPlanner.travelPrefsRightShadow.css({right:Math.min(0,tfl.journeyPlanner.travelPrefsScrollMax-w-40)})}).scroll();$(window).resize(function(){tfl.journeyPlanner.travelPrefsScrollMax=tfl.journeyPlanner.travelPrefsInnerWidth-$(".scroller").width();$(".scroller").scroll()})}$(".cancel-button").click(function(){$(".toggle-options.less-options").click();$("#plan-a-journey").removeClass("editing").parents(".r").removeClass("expanded");$(".journey-result-summary .secondary-button").focus();return false})}})(window.tfl.journeyPlanner.results=window.tfl.journeyPlanner.results||{});window.tfl.journeyPlanner=window.tfl.journeyPlanner||{};(function(a){tfl.logs.create("tfl.journeyPlanner.disambiguation: loaded");a.init=function(){tfl.logs.create("tfl.journeyPlanner.disambiguation: initialised");var b=$(".disambiguation-wrapper");var d=b.length;var c=0;if(d>0){$(".disambiguation-extras").prepend("<div class='pagination' />");$(".disambiguation-box").each(function(){var h=$(this).find(".disambiguation-option").length;if(h>tfl.journeyPlanner.settings.disambiguationItemsPerPage){tfl.navigation.pagination.setup($(this),".disambiguation-items",tfl.journeyPlanner.settings.disambiguationItemsPerPage,h,true)}var j=$(this).parents(".disambiguation-wrapper");var f=j.hasClass("from-results");if(f){$(".summary-row").eq(0).addClass("disambiguating")}else{var g=j.hasClass("to-results");if(g){$(".summary-row").eq(1).addClass("disambiguating")}else{$(".via-destination").addClass("disambiguating")}}})}$(".disambiguation-link").click(function(){var g=$(this).parents(".disambiguation-wrapper");if(g.hasClass("from-results")){$("#From").val($(this).find(".place-name").text()).after("<input type='hidden' name='FromId' value='"+$(this).attr("data-param")+"' />");$("#disambiguation-map-from").html("")}else{if(g.hasClass("to-results")){$("#To").val($(this).find(".place-name").text()).after("<input type='hidden' name='ToId' value='"+$(this).attr("data-param")+"' />");$("#disambiguation-map-to").html("")}else{if(g.hasClass("via-results")){$("#Via").val($(this).find(".place-name").text()).after("<input type='hidden' name='ViaId' value='"+$(this).attr("data-param")+"' />");$("#disambiguation-map-via").html("")}}}var f=g.next(".disambiguation-wrapper");if(f.length>=1){g.hide();f.show();f.find(".disambiguation-map").controller().divResized()}else{$("#jp-search-form").submit()}return false});b.each(function(){if(c>0){$(this).hide()}c++});tfl.mapInteractions.init();function e(h,f){var j=tfl.maps[h].googleMap;j.on("optionChosen",function(k){f.find(".disambiguation-option[data-id='"+k.id+"'] .disambiguation-link")[0].click()});var g=f.parent().find(".pagination");if(g.length){tfl.navigation.pagination.addMapControls(g,j.controller)}}$("#disambiguation-options-from, #disambiguation-options-to, #disambiguation-options-via").each(function(){var f=$(this);if(f.find(".disambiguation-option").length>0){var g=$(this).attr("id").replace("-options-","-map-").replace("-","");if(tfl.maps[g]!==undefined){e(g,f)}else{$(window).on("map-object-created-"+g,function(){e(g,f)})}}})}})(window.tfl.journeyPlanner.disambiguation=window.tfl.disambiguation||{});window.tfl.journeyPlanner=window.tfl.journeyPlanner||{};(function(b){tfl.logs.create("tfl.journeyPlanner.searchForm: loaded");b.isWidget;b.widgetInit=function(){tfl.logs.create("tfl.journeyPlanner.searchForm: started widgetInit");$(".toggle-options, .change-departure-time").click(function(j){var h=$(this);var l=h.attr("href");var m=l.substr(0,l.indexOf("#"));var k=l.substr(l.indexOf("#"));$.each(["From","To","FromId","ToId","FromGeolocation","ToGeolocation"],function(n,o){var p=$("#"+o).val();if(p!==undefined&&p!==""){if(n==0){m+="?"}if(n>0){m+="&"}m+=o+"="+p}});h.attr("href",m+k)})};b.setupDateOptions=function(){var h=new Date();var j=((15-h.getMinutes()%15)*60000);var k=((60-h.getSeconds()%60)*1000);setTimeout(b.incrementCurrentTime,(j-k))};b.processTempLocalStorage=function(){var j=tfl.storage.get("tempJPLocalStorage",[[]]);if(j.length>0){for(var h=0;h<j.length;h++){$(j[h][0]).attr(j[h][1],j[h][2])}}};b.submitSearchForm=function(){var h=$("#From");var k=$("#To");var l=$("#Via");if(h.attr("data-from-id")){if($("#FromId").length==0){$(this).append("<input type='hidden' id='FromId' name='FromId' value='"+h.attr("data-from-id")+"' />")}else{$("#FromId").val(h.attr("data-from-id"))}}if(k.attr("data-to-id")){if($("#ToId").length==0){$(this).append("<input type='hidden' id='ToId' name='ToId' value='"+k.attr("data-to-id")+"' />")}else{$("#ToId").val(k.attr("data-to-id"))}}if(l.attr("data-via-id")){$(this).append("<input type='hidden' id='ViaId' name='ViaId' value='"+l.attr("data-via-id")+"' />")}var j=[[]];if(h.attr("data-from-modes")){j.push(["#From","data-from-modes",h.attr("data-from-modes")])}if(h.attr("data-dataset-name")){j.push(["#From","data-dataset-name",h.attr("data-dataset-name")])}if(k.attr("data-to-modes")){j.push(["#To","data-to-modes",k.attr("data-to-modes")])}if(k.attr("data-dataset-name")){j.push(["#To","data-dataset-name",k.attr("data-dataset-name")])}if(l.attr("data-via-modes")){j.push(["#Via","data-via-modes",l.attr("data-via-modes")])}if(l.attr("data-dataset-name")){j.push(["#Via","data-dataset-name",l.attr("data-dataset-name")])}if(j.length>0){tfl.storage.set("tempJPLocalStorage",j)}if(h.val()!==tfl.dictionary.CurrentLocationText){$("#FromGeolocation").val("")}if(k.val()!==tfl.dictionary.CurrentLocationText){$("#ToGeolocation").val("")}if(l.val()!==tfl.dictionary.CurrentLocationText){$("#ViaGeolocation").val("")}return true};b.changeTabs=function(){var j=$('[data-jp-tabs="true"]');var h=j.parents(".journey-planner-results").length>0;j.children().click(function(){var k=$("#JpType");var n=k.val();var l=$(this).children("a");var m=l.attr("data-jptype");j.removeClass(n).addClass(m);$("#jp-search-form").removeClass(n).addClass(m);k.val(m);if(h){var o=$("#OptionsForPublictransport");if(k.val()==tfl.dictionary.JpTypeCycling||k.val()==tfl.dictionary.JpTypeWalking){o.hide()}else{o.show()}if(l.hasClass("has-time")){$(".summary-results").removeClass(n).addClass(m);window.tfl.journeyPlanner.results.unshowAllDetailedResults();window.tfl.journeyPlanner.results.currentlyShowing=null}else{$("#jp-search-form").submit()}window.tfl.journeyPlanner.results.maps(m);if(m==="publictransport"){$(".no-public-transport").show()}else{$(".no-public-transport").hide()}}})};b.incrementCurrentTime=function(){if($(".time-options.change-time").length===0){b.setCurrentTime()}setTimeout(b.incrementCurrentTime,900000)};b.getCurrentDate=function(){var h=new Date();var l=h.getFullYear().toString();var k=(h.getMonth()+1).toString();var j=h.getDate().toString();return l+(k[1]?k:"0"+k[0])+(j[1]?j:"0"+j[0])};b.getCurrentTime=function(){var h=new Date();var l=h.getMinutes();l=l=0?l:(l+(15-(l%15)));var j=h.getHours();if(l===60){l=0;j++;if(j===24){j=0}}var m=""+l;if(m.length===1){m="0"+m}var k=""+j;if(k.length===1){k="0"+k}return k+m};b.setCurrentTime=function(){var h=new Date();var l=h.getMinutes();l=(l+(15-(l%15)));var j=h.getHours();if(l===60){l=0;j++;if(j===24){j=0;$("#Date").val($("#Date option:selected").next().val());$(".date-of-departure > span").text("Tomorrow")}}var m=""+l;if(m.length===1){m="0"+m}var k=""+j;if(k.length===1){k="0"+k}$("#Time").val(k+m);$(".hours span").text(k+":"+m)};b.changeDepartureTime=function(){$(".time-options").toggleClass("change-time");return false};b.toggleMoreOptions=function(){$(this).parents(".r").toggleClass("expanded");var h=$(".toggle-options");if(h.hasClass("more-options")){h.removeClass("more-options").addClass("less-options").text(tfl.dictionary.LessOptions)}else{h.removeClass("less-options").addClass("more-options").text(tfl.dictionary.MoreOptions+tfl.dictionary.CustomisedOptions)}return false};b.toggleMoreOptionsIsWidget=function(){var h=$(this);var m=h.attr("href");var n=m;if(m.indexOf("?")!=-1){n=m.substr(0,m.indexOf("?"))}else{n=m.substr(0,m.indexOf("#"))}var r="";var l=m.substr(m.indexOf("#"));$.each(["From","To","FromGeolocation","ToGelocation"],function(s,t){var u=$("#"+t).val();if(u!==undefined&&u!==""){if(s==0){r+="?"}if(s>0){r+="&"}r+=t+"="+u}});var j=[];var k=$("#From");var q=$("#To");if(k.attr("data-from-id")){j.push(["fromId",k.attr("data-from-id")])}if(q.attr("data-to-id")){j.push(["toId",q.attr("data-to-id")])}j.push(["date",$("#Date").find("option:selected").val()]);j.push(["timeIs",$(".leaving-or-arriving .selected input").val()]);j.push(["time",$("#Time").find("option:selected").val()]);if(r.indexOf("?")==-1){r+="?"}for(var o=0;o<j.length;o++){r+="&"+j[o][0]+"="+j[o][1]}h.attr("href",n+r+l);var p=[[]];if(k.attr("data-from-modes")){p.push(["#From","data-from-modes",k.attr("data-from-modes")])}if(k.attr("data-dataset-name")){p.push(["#From","data-dataset-name",k.attr("data-dataset-name")])}if(q.attr("data-to-modes")){p.push(["#To","data-to-modes",q.attr("data-to-modes")])}if(q.attr("data-dataset-name")){p.push(["#To","data-dataset-name",q.attr("data-dataset-name")])}if(p.length>0){tfl.storage.set("tempJPLocalStorage",p)}};b.buildSwitchButton=function(){$(".geolocation-box").after("<a href='javascript:void(0)' class='switch-button hide-text'>Switch from and to<a>")};b.switchFromTo=function(){var l=$("#From");var m=$("#FromGeolocation");var t=$("#To");var u=$("#ToGeolocation");var h=l.val();var o=l.attr("data-from-id")?l.attr("data-from-id"):"";var p=l.attr("data-from-modes")?l.attr("data-from-modes"):"";var k=l.attr("data-dataset-name")?l.attr("data-dataset-name"):"";var j=l.parent().attr("data-current-location")?l.parent().attr("data-current-location"):"";var n=m.val();var q=t.val();var w=t.attr("data-to-id")?t.attr("data-to-id"):"";var y=t.attr("data-to-modes")?t.attr("data-to-modes"):"";var s=t.attr("data-dataset-name")?t.attr("data-dataset-name"):"";var r=t.parent().attr("data-current-location")?t.parent().attr("data-current-location"):"";var v=u.val();l.typeahead("setQuery",q);l.attr("data-from-id",w);l.attr("data-from-modes",y);l.attr("data-dataset-name",s);if(r!==""){l.parent().attr("data-current-location",r)}else{l.parent().removeAttr("data-current-location")}l.trigger("change");t.typeahead("setQuery",h);t.val(h);t.attr("data-to-id",o);t.attr("data-to-modes",p);t.attr("data-dataset-name",k);if(j!==""){t.parent().attr("data-current-location",j)}else{t.parent().removeAttr("data-current-location")}t.trigger("change");m.val(v);u.val(n)};var c=tfl.autocomplete.sources.recentSearches;var f=tfl.autocomplete.sources.getTurnOnOffRecentSearches(false,[{linkText:"Turn off recent journeys"}]);var d=[tfl.autocomplete.sources.journeyPlannerSuggestions];var g=tfl.autocomplete.sources.getTurnOnOffRecentSearches(true,[{linkText:"Turn on recent journeys"}]);var e=[tfl.autocomplete.sources.journeyPlannerSuggestions];b.setupAutocomplete=function(h){c.name="journey-planner-recent-searches";c.local=tfl.autocomplete.addBlankTokens(tfl.journeyPlanner.recentSearches.searches);c.template="<div class='mode-icons'>{{#placeModes}}<span class='mode-icon {{.}}-icon'>&nbsp;</span>{{/placeModes}}</div><span class='stop-name'>{{placeName}}</span>";c.limit=tfl.journeyPlanner.recentSearches.recentSearchNumberLimit;c.valueKey="placeName";c.callback=tfl.autocomplete.sources.stationsStopsSelectionCallback;c.removeContent=tfl.autocomplete.sources.stationsStopsRemoveContent;b.autocompleteAddRecentSearches(!h);b.autocompleteAddGeolocation();f.callback=function(j){tfl.journeyPlanner.recentJourneys.useJourneys(false);if($("#recent-journeys").length!=0){tfl.journeyPlanner.createJourneys()}$(j).parent().siblings(tfl.dictionary.RemoveContentClass).trigger("clear-search-box");b.destroyAutocomplete();$("#From, #To, #Via").each(function(){tfl.autocomplete.setup("#"+$(this).attr("id"),e);$("#"+$(this).attr("id")).attr("placeholder",$(this).attr("id"))})};g.callback=function(j){tfl.journeyPlanner.recentJourneys.useJourneys(true);if($("#recent-journeys").length!=0){tfl.journeyPlanner.createJourneys()}$(j).parent().siblings(tfl.dictionary.RemoveContentClass).trigger("clear-search-box");b.destroyAutocomplete();$("#From, #To, #Via").each(function(){tfl.autocomplete.setup("#"+$(this).attr("id"),d);$("#"+$(this).attr("id")).attr("placeholder",$(this).attr("id"))})};if(tfl.journeyPlanner.recentJourneys.usingRecentJourneys){tfl.autocomplete.setup("#From",d,h);tfl.autocomplete.setup("#To",d,h);tfl.autocomplete.setup("#Via",d,h)}else{tfl.autocomplete.setup("#From",e,h);tfl.autocomplete.setup("#To",e,h);tfl.autocomplete.setup("#Via",e,h)}};b.destroyAutocomplete=function(){$("#From, #To, #Via").each(function(){$(this).parent().siblings(tfl.dictionary.RemoveContentClass).unbind("clear-search-box");$(this).typeahead("destroy");$(this).off("typeahead:selected typeahead:autocompleted keydown.autocomplete")});d=[tfl.autocomplete.sources.journeyPlannerSuggestions];b.autocompleteAddRecentSearches(true);b.autocompleteAddGeolocation()};b.autocompleteAddRecentSearches=function(h){if(tfl.storage.isLocalStorageSupported()){d.splice(0,0,f);if(tfl.journeyPlanner.recentJourneys.usingRecentJourneys&&!h){d.splice(0,0,c)}e.splice(0,0,g)}};b.autocompleteAddGeolocation=function(){var h=tfl.autocomplete.sources.geolocation;h.callback=function(j){$(j).removeAttr("data-dataset-name");tfl.autocomplete.sources.stationsStopsRemoveContent(j);tfl.geolocation.geolocateMe(j)};if(tfl.geolocation.isGeolocationSupported()){d.splice(0,0,h);e.splice(0,0,h)}};function a(){$("#From, #To, #Via").each(function(){$(this).on("keydown",function(j){if(j.which!==9&&j.which!==13&&(j.which<33||j.which>40)&&(j.which<16||j.which>20)&&j.which!==45&&j.which!==91){h($(this))}});$(this).on("paste",function(){h($(this))})});function h(j){j.removeAttr("data-"+j.attr("id").toLowerCase()+"-id");j.removeAttr("data-"+j.attr("id").toLowerCase()+"-modes");j.removeAttr("data-dataset-name")}}b.init=function(k){tfl.logs.create("tfl.journeyPlanner.searchForm.init: started (widget = "+k+")");b.isWidget=k||false;b.processTempLocalStorage();var h=$(".leaving-or-arriving .selected label").text();$(".time-options").prepend("<div class='time-defaults'><p><strong>"+h+":</strong> <span>now</span></p><a href='javascript:void(0)' class='change-departure-time'>change time</a></div>");if(!String.prototype.indexOf||window.location.href.indexOf("&time=")>0){$(".change-time-options").show();$(".time-defaults").hide()}$(".extra-options").prepend('<a href="'+tfl.jPLandingPageUrl+'#more-options" class="toggle-options more-options">Accessibility &amp; travel options</a>');$("#jp-search-form").submit(b.submitSearchForm);tfl.journeyPlanner.recentSearches.loadSearches();$(".change-departure-time").click(b.changeDepartureTime);b.setupDateOptions();if(!b.isWidget){b.changeTabs();$(".toggle-options").click(b.toggleMoreOptions)}else{$(".toggle-options").click(b.toggleMoreOptionsIsWidget)}if(window.location.hash==="#more-options"){$(".toggle-options").click()}else{if(window.location.hash==="#change-time"){b.changeDepartureTime()}}$("#IsAsync").val(true);b.setupAutocomplete(true);a();var j=$("#From"),l=$("#To"),m=$("#Via");$([j,l,m]).each(function(){if(this.val()===tfl.dictionary.CurrentLocationText){tfl.geolocation.setupInputBoxForGeolocation(this)}})}}(window.tfl.journeyPlanner.searchForm=window.tfl.journeyPlanner.searchForm||{}));(function(a){a.initialize=function(){a.setUpResultTags();a.populateSearchBoxes();a.resetSelectBoxes();a.checkQueryString();a.selectBoxFiltering();a.selectBoxChange()};a.resetSelectBoxes=function(){$(".reset-filters").click(function(){$(".selector").children(".filter-box").each(function(){$(this).prop("selectedIndex",0);$(this).siblings("span").text($(this).children("option:first-child").text());a.selectBoxFiltering()})})};a.checkQueryString=function(){var g=$(location).attr("href");if(g.indexOf("?")>=0){var h=g.split("?");var b=h[1].split("&");var e=(b.length);var d=0;var f=new Array();while(d<e){f.push(b[d].replace(/%20/g," "));d++}var c=0;$(".filter-box").each(function(){var l=$(this).attr("name");for(x=0;x<f.length;x++){var k=f[x].split("=");if(k[0]==l){var j=$(this).children().text();if(j.indexOf(k[1])<=0){}else{$(this).siblings("span").text(k[1])}}else{}a.selectBoxFiltering()}})}else{}};a.tagSet=function(){var b=$(this).text()};a.selectBoxChange=function(){$("select.filter-box").change(function(){a.selectBoxFiltering()})};a.setUpResultTags=function(){$(".results-list-all").find("data-pull-content").click(tfl.navigation.pullContentHandler);$(".results-list-all").hide();$(".results-list-all").children("#results-list").children("li.search-results").each(function(){var d=$(this).children(".search-tags");var f=d.text();var e=f.split(",");var c=(e.length);for(var g=0;g<c;g++){d.append("<a class='result-tag'>"+e[g]+"</a>")}var b=d.children().remove();d.text("").append(b)})};a.selectBoxFiltering=function(){$("#pagination-items").empty();$(".pagination").remove();$(".search-results").each(function(){var c=false;var d=new Array();$(this).find("a.result-tag").each(function(){var e=$(this).text();d[d.length]=e});$(".selector").children(".filter-box").each(function(){var f=$(this).siblings("span").text();if(f=="All"){return true}var e=($.inArray(f,d));if(e==-1){c=true;return false}});if(!c){$(this).clone(true).appendTo("#pagination-items")}});var b=$("#pagination-items > li").length;if(b===0){if($(".field-validation-information").length<1){$(".results-wrapper").append("<p class='field-validation-information' id='search-filters-no-results'>There is nothing matching your search.</p>")}}else{$("#search-filters-no-results").remove()}a.PaginateSearchFilters()};a.PaginateSearchFilters=function(){var b=5;$(".pagination-controls").remove();if($("#pagination-items .search-results").length>b){$(".results-wrapper ul").after("<div class='pagination' />");tfl.navigation.pagination.setup($(".results-wrapper"),"#pagination-items",b,$("#pagination-items .search-results").length,true)}};a.populateSearchBoxes=function(){$(".search-filters-wrapper").append("<div class='search-filter filter-by-box'><a class='reset-filters'>Reset</a><p class='heading'>Filter by:</p>");for(var c=0;c<=filters.length;c++){for(var b in filters[c]){$(".filter-by-box").append("<div class='filter-box-wrap'></div");$(".filter-box-wrap").eq(c).append("<label for='"+b+"' class='heading'>"+b+":</label><div class='selector'><select class='filter-box' name="+b+" class='valid'><option selected='selected'>All</option></select></div>");for(var d=0;d<filters[c][b].length;d++){$(".filter-box-wrap").eq(c).find(".filter-box").append("<option>"+filters[c][b][d]+"</option>")}}}tfl.forms.setupSelectBoxes()};$(document).ready(function(){tfl.logs.create("tfl.searchFilters: looking for search filters");var b=$(".search-filters-wrapper");if(b.length>0){tfl.logs.create("tfl.searchFilters: loading search filters");a.initialize()}})})(window.tfl.searchFilters=window.tfl.searchFilters||{});(function(a){a.tabs=function(b){tfl.logs.create("tfl.navigation.tabs: loaded");var c=$(b).children();c.click(function(d){d.preventDefault();c.removeClass("selected");$(this).addClass("selected");tfl.logs.create("tfl.navigation.tabs: "+$(this).find("a").attr("href"))})};a.tabs("[data-tabs='true']")}(window.tfl.navigation=window.tfl.navigation||{}));(function(a){a.RemoveContentClass=".remove-content";tfl.logs.create("tfl.removableContent.initRemoveContents: loaded");a.initRemoveContents=function(){tfl.logs.create("tfl.removableContent.initRemoveContents: started");var b=$(":input:text").not(".disable-removable-content");b.clearSearch({divClass:"remove-content-container",clearClass:"remove-content",linkText:"Clear search"});b.not(".tt-hint").each(function(){if($(this).val()===""){$(this).closest(".remove-content-container").addClass("empty")}}).on("keyup",function(){if($(this).val()===""){$(this).closest(".remove-content-container").addClass("empty")}else{$(this).closest(".remove-content-container").removeClass("empty")}});$(".remove-content").addClass("hide-text").click(function(){var c=$(this).siblings("[data-current-location]");if(c.length===0){c=$(this).parent("[data-current-location]")}if(c.length>0){c.removeAttr("data-current-location");c.find("input[type='text']").trigger("geolocation-cleared")}$(this).closest(".remove-content-container").addClass("empty")})};a.initRemoveContents()}(window.tfl.removableContent=window.tfl.removableContent||{}));(function(a){tfl.logs.create("tfl.survey: started");a.success=function(){$("#survey").removeAttr("src");d(true)};$.ajax({url:"/corporate/feedback/"}).done(function(e){$(".cookie-policy-notice").after(e);$(".beta-banner-link").click(function(){b();d(false)})});function d(e){if($("html.lt-ie8").length>0){$(".beta-banner-form").toggle();c()}else{$(".beta-banner-form").slideToggle("slow",function(){if(e){$(".beta-banner-submit").slideDown("slow",function(){c()}).delay(1000).slideUp("slow",function(){c()})}c()})}}function b(){var e=$("body");var f="small";if(e.hasClass("breakpoint-Large")){f="large"}else{if(e.hasClass("breakpoint-Medium")){f="medium"}}var g=$("#survey");if(g.attr("src")===null||g.attr("src")===undefined||g.attr("src")===""){var h="https://www.research.net/s/tfl_beta?layout="+f+"&page="+encodeURIComponent(location.href)+"&device="+encodeURIComponent(navigator.userAgent);g.attr("src",h)}}function c(){var g=$(".beta-banner-link");var e="link-accordion-expanded";g.toggleClass(e);if($("html.lt-ie8").length>0){var f=$(".top-row, #full-width-content");f.addClass("ie7-fix");window.setTimeout(function(){f.removeClass("ie7-fix")},5)}}})(tfl.survey=tfl.survey||{});window.tfl.navigation=window.tfl.navigation||{};(function(a){tfl.logs.create("tfl.navigation.pagination: loaded");a.setup=function(b,d,e,j,c,f){var g=j%e>0?Math.floor(j/e)+1:Math.floor(j/e);var h=g>5?3:g;if(!c){b.append("<div class='pagination' />")}b.pajinate({items_per_page:e,item_container_id:d,nav_panel_id:".pagination",num_page_links_to_display:h,nav_label_first:"1",nav_label_prev:"",nav_label_next:"",nav_label_last:g,show_first_last:true,show_prev_next:false,abort_on_small_lists:true});b.find(".pagination").wrap("<div class='pagination-controls' />");b.find(".previous_link").prependTo(b.find(".pagination"));b.find(".next_link").appendTo(b.find(".pagination"));a.checkPageLinks(b,g);b.find(".pagination a").click(function(){a.checkPageLinks(b,g);if($(window).scrollTop()>b.offset().top){window.scrollTo(0,b.offset().top)}})};a.addMapControls=function(b,c){var d=1;if(c){b.find(".page_link").click(function(){d=parseInt($(this).attr("data-longdesc"),10);c.choosePage(d)});b.find(".previous_link").click(function(){c.choosePage(--d)});b.find(".next_link").click(function(){c.choosePage(++d)});b.find(".first_link").click(function(){d=1;c.choosePage(1)});b.find(".last_link").click(function(){b.find(".page_link.last").trigger("click")})}};a.checkPageLinks=function(b,d){if(d<6){b.find(".first_link,.last_link").hide()}else{var e=b.find(".page_link");if($(e[0]).hasClass("active_page")){$(e[0]).hide();$(e[3]).show();b.find(".next_link").prepend("<span>next-page</span>");b.find(".previous_link").prepend("<span>previous-page</span>");b.find(".first_link").addClass("active_page")}else{if($(e[e.length-1]).hasClass("active_page")){$(e[e.length-1]).hide();$(e[e.length-4]).show();b.find(".last_link").addClass("active_page")}else{for(var c=2;c<e.length-2;c++){if($(e[c]).hasClass("active_page")){$(e[c+2]).hide();$(e[c+1]).show();$(e[c-1]).show();$(e[c-2]).hide();break}}}}}}}(window.tfl.navigation.pagination=window.tfl.navigation.pagination||{}));(function(a){a.getQueryStringParameter=function(d){var e=window.location.search.substring(1),f=e.split("&"),b;for(b=0;b<f.length;b+=1){var c=f[b].split("=");if(decodeURIComponent(c[0])===d){return decodeURIComponent(c[1])}}return null};a.setQueryStringParameter=function(e,g){if(window.history.pushState!==undefined){var f=window.location.search.substring(1),h=f.split("&"),c,b=false;for(c=0;c<h.length;c+=1){var d=h[c].split("=");if(decodeURIComponent(d[0])===e){d[1]=encodeURIComponent(g);h[c]=d.join("=");window.history.pushState({},"","?"+h.join("&"));b=true;break}}if(!b){if(f.length===0){f+="?"+encodeURIComponent(e)+"="+encodeURIComponent(g);window.history.pushState({},"",f)}else{f+="&"+encodeURIComponent(e)+"="+encodeURIComponent(g);window.history.pushState({},"","?"+f)}}}};a.removeQueryStringParameter=function(e){if(window.history.pushState!==undefined){var f=window.location.search.substring(1),g=f.split("&"),c,b=false;for(c=0;c<g.length;c+=1){var d=g[c].split("=");if(decodeURIComponent(d[0])===e){g.splice(c,1);window.history.pushState({},"","?"+g.join("&"));b=true;break}}}};a.measureElementHeight=function(b,c){var e=b.attr("style");b.removeAttr("style").css({position:"fixed",left:"-10000px",display:c||"block"});var d=b.height();return d};a.measureElementWidth=function(b,c){var e=b.attr("style");b.removeAttr("style").css({position:"fixed",left:"-10000px",display:c||"block"});var d=b.width();b.removeAttr("style").attr("style",e);return d};a.makeMVCDate=function(c){function b(e){var f="";if(e<10){f+="0"}f+=e;return f}var d="";d+=c.getFullYear()+"-";d+=b(c.getMonth()+1)+"-";d+=b(c.getDate())+"T";d+=b(c.getHours())+":";d+=b(c.getMinutes())+":";d+=b(c.getSeconds());return d};a.makeDateFromQueryStringDate=function(c){var b=new Date();b.setDate(c.substring(8,10));b.setMonth(c.substring(5,7)-1);b.setYear(c.substring(0,4));b.setHours(c.substring(11,13));b.setMinutes(c.substring(14,16));b.setSeconds(c.substring(17,19));return b};a.getTime=function(b){return(b.getHours()<10?"0":"")+b.getHours()+":"+(b.getMinutes()<10?"0":"")+b.getMinutes()};if(!String.prototype.format){String.prototype.format=function(){var b=arguments;return this.replace(/{(\d+)}/g,function(c,d){return typeof b[d]!="undefined"?b[d]:c})}}}(window.tfl.tools=window.tfl.tools||{}));(function(a){a.init=function(){$(".always-visible").off("click.expandableBox").on("click.expandableBox",function(){var b=$(this).parent();if(!b.hasClass("expanded")){b.addClass("expanded");$(this).attr("aria-expanded","true").trigger("expandable-box.expanded")}else{b.removeClass("expanded");$(this).attr("aria-expanded","false").trigger("expandable-box.collapsed")}return false}).keypress(function(b){if(b.which==13){$(this).click()}})};a.init()}(window.tfl.expandableBox=window.tfl.expandableBox||{}));(function(b){function a(d){var c=d,g=c.parent(),f=c.find(">li"),e=null,l=0,h=13,n=[],j=[],q=0,r=0,k=0,m=false,p=false,o=null;return{init:function(){e=$("<li class='ellipsis hidden'><a href='javascript:void(0)'>...</a></li>");f.eq(0).after(e);l=e.width();e.click(this.makeScrollable);f.each(function(){var u=$(this).width();n.push(u);q+=u});q+=h;j.push(q);var s=q;for(var t=1;t<n.length;t++){s-=n[t];j.push(s+l)}o=$.proxy(this.onResize,this);$(window).on("resize",o);this.onResize()},onResize:function(){r=c.width();if(r<q){if(r<=j[k]){m=true;e.removeClass("hidden");while(r<=j[k]){this.hideItem(k);k++}}else{if(r>j[k]){while(r>j[k]){this.showItem(k);k--}}}}else{if(m){e.addClass("hidden");m=false;while(r>=j[k]){this.showItem(k);k--}if(k<0){k=0}}}},hideItem:function(s){f.eq(s+1).hide()},showItem:function(s){f.eq(s+1).show()},makeScrollable:function(){if(tfl.utils.isTouchDevice()){g.addClass("scrolling");c.css({width:q+"px"})}e.addClass("hidden");f.each(function(){$(this).show()});$(window).off("resize",o);return false}}}b.init=function(){var d=$("ul.breadcrumbs");var c=d.length;$("ul.breadcrumbs").each(function(){d=$(this);new a(d).init()})};b.init()}(window.tfl.breadcrumb=window.tfl.breadcrumb||{}));(function(a){a.init=function(b){$(b).each(function(){var e=$(this);e.wrap('<div class="fc-calendar-wrapper clearfix" />');var f=e.parent();var c=e.calendario({weekabbrs:["S","M","T","W","T","F","S"],displayWeekAbbr:true,month:e.attr("data-month"),year:e.attr("data-year")});f.prepend("<div class='current-month'><a href='javascript:void(0);' class='calendar-previous-month hide-text'>Previous month</a><span class='calendar-month'>"+c.getMonthName()+"</span> <span class='calendar-year'>"+c.getYear()+"</span><a href='javascript:void(0);' class='calendar-next-month hide-text'>Next month</a></div>");f.find(".calendar-next-month").on("click",function(){if(!$(this).hasClass("disabled")){c.gotoNextMonth(function(){h();e.attr("data-month",c.getMonth());e.attr("data-year",c.getYear());$(window).trigger("calendar-next-month")})}});f.find(".calendar-previous-month").on("click",function(){if(!$(this).hasClass("disabled")){c.gotoPreviousMonth(function(){h();e.attr("data-month",c.getMonth());e.attr("data-year",c.getYear());$(window).trigger("calendar-previous-month")})}});var d=f.find(".calendar-month");var g=f.find(".calendar-year");var h=function(){d.html(c.getMonthName());g.html(c.getYear())}})};a.init(".fc-calendar-container")}(window.tfl.calendar=window.tfl.calendar||{}));(function(a){a.allTables=[];a.tableCellPadding=5;a.tableShadowWidth=15;a.ResponsiveTable=function(b){var t=b;var p=$(t).parent();var n=null;var u=null;var v=null;var l=null;var m=false;var o=null;var r=null;var q=null;var s=null;var f=null;var h=0;var k=0;var j=0;var g=false;var c=null;var e=0;var d=0;return{init:function(){var w=this;w.onResize();p.scroll(w.onParentScroll);if($(p).closest(".expandable-box").length){$(p).closest(".expandable-box").find(".always-visible").on("click",function(){w.onResize()})}},onResize:function(){var z=this.isVisible;if($(p).is(":visible")){this.isVisible=true}else{this.isVisible=false}if(!z&&this.isVisible){this.stopHiding();this.startHiding()}var w=$(p).offset();n=w.left;u=w.top;v=$(t).width();l=$(t).height();q=$(p).width();if(f){h=f.height()?f.height():h;var y=$(t).offset();k=y.top;j=y.left;if(m){f.parent().css({width:q,left:n});this.onWindowScroll($(window).scrollTop())}}if(c){e=c.width()-2*a.tableCellPadding}if(v>q){if(!m){this.startHiding()}else{s=v-q;this.onParentScroll()}}else{if(m){this.stopHiding()}}},onWindowScroll:function(y){var w=$(p).offset();n=w.left;u=w.top;if(m&&!g&&(u<y&&y<=u+l-h)){g=true;$(f).css({marginLeft:-1*$(p).scrollLeft()});$(f).parent().removeClass("hidden")}else{if(g){if(u>=y||y>u+l-h){g=false;$(f).parent().addClass("hidden")}}}},onParentScroll:function(){var w=$(p).scrollLeft();$(f).css({marginLeft:(-1*w)});o.css({left:e+2*a.tableCellPadding-a.tableShadowWidth+Math.min(w,a.tableShadowWidth)});var y=Math.min(s-w,a.tableShadowWidth)-a.tableShadowWidth;if(y===-1*a.tableShadowWidth){y++}r.css({right:y})},startHiding:function(){m=true;p.addClass("hiding");if(p.children(".hiding-table").length>0){f.css({width:v});p.children(".hiding-table").show()}else{this.createFixedHeadings()}p.parent().addClass("hiding")},stopHiding:function(){m=false;p.removeClass("hiding");p.parent().removeClass("hiding");p.parent().find(".hiding-table").hide();g=false;$(f).parent().addClass("hidden")},createFixedHeadings:function(){v=$(t).width();f=$("<table class='first-row'></table>");var w=$(t).find("tr:first-child");h=w.height();f.append(w.clone().css({height:h,width:v}));f.find("th").replaceWith(function(){return $("<td />",{html:$(this).html()})});var y=w.find("th, td");$(f).find("th, td").each(function(z){if(z===0){$(this).html("<span>"+$(this).html()+"</span>")}$(this).width($(y.get(z)).width())});c=$("<table class='hiding-table first-col'></table>").css({top:0});e=0;d=0;$(t).find("th:first-child,td:first-child").each(function(z){if(z===0){e=$(this).width();d=$(this).offset().left}var A=$("<tr></tr>");A.append($(this).clone().css({height:$(this).height()}));c.append(A)});p.wrap("<div class='responsive-table-wrapper'></div>");p.parent().append(c.css({width:e,position:"absolute"}));f.wrap("<div class='hidden'></div>");c.after(f.css({width:v}).parent().css({overflow:"hidden",width:q,position:"fixed",top:0,boxShadow:"0px 5px 5px -3px rgba(0, 0, 0, 0.3)"}));l=$(t).height();k=$(f).parent().offset().top;j=$(t).offset().left;o=$("<div class='responsive-table-shadow left-shadow' />");o.css({left:e+2*a.tableCellPadding-a.tableShadowWidth,height:l});r=$("<div class='responsive-table-shadow right-shadow' />");r.css({right:0,height:l});c.before(o);c.before(r);s=v-q;this.onWindowScroll($(window).scrollTop())}}};a.init=function(b){$(b).each(function(c){var d=new a.ResponsiveTable(this);d.init();a.allTables.push(d)});if(a.allTables.length>0){$(window).resize(function(){for(var c=0;c<a.allTables.length;c++){a.allTables[c].onResize()}});$(window).scroll(function(){var d=$(this).scrollTop();for(var c=0;c<a.allTables.length;c++){a.allTables[c].onWindowScroll(d)}})}};a.init(".table-container table")}(window.tfl.responsiveTables=window.tfl.responsiveTables||{}));(function(g){tfl.logs.create("tfl.fullscreen stage: loaded");var c,b,a,e=[],f=false,l=false,j=[],k=[],q=false,m=0,h={id:"fullscreen-stage",stageActiveClass:"stage-active"};function p(r){var o=$('<div id="'+h.id+'"></div>');if(!r){a=$('<button id="close-fullscreen-stage" class="fullscreen-stage-button"><span class="icon close-icon"></span></button>');o.append(a);a.on("click",n)}$(document.body).append(o);f=true;return o}function d(o){tfl.logs.create("tfl.fullscreen: enter fullscreen stage");g.addItemToStage(o);$(document.body).addClass(h.stageActiveClass);$(window).trigger("enter-fullscreen-stage");if(q&&e.length===1){$(document.body).addClass("panzoom");tfl.zoomableContent.init(o)}}function n(){tfl.logs.create("tfl.fullscreen: exit fullscreen stage");var o;for(var r=e.length-1;r>=0;r--){o=e[r];if(k[r]){j[r].append(o)}else{j[r].before(o)}}e=[];j=[];k=[];if(q){$(document.body).removeClass("panzoom");o.trigger("destroy-panzoom")}$(document.body).removeClass(h.stageActiveClass);$(window).trigger("exit-fullscreen-stage")}g.addItemToStage=function(o){if(!c){tfl.logs.create("tfl.fullscreen: Tried to add item to stage before stage was initialised");return}var r=o.next();if(r.length===0){j[j.length]=o.parent();k[k.length]=true}else{j[j.length]=r;k[k.length]=false}e.push(o);c.append(o)};g.hide=function(){if(e.length!==0){n()}document.body.scrollTop=m};g.display=function(o,s,r){if(!f){c=p(r||false)}q=s;if(e.length!==0){n()}m=document.body.scrollTop;d(o)}})(window.tfl.fullscreen=window.tfl.fullscreen||{});(function(b){tfl.logs.create("tfl.listToDropdown: loaded");var c,a;b.init=function(){tfl.logs.create("tfl.listToDropdown: initialised");b.buildHtmlDropdown();b.dropDownMouseFunctionality();b.hideShowList();b.datePickerDropdownBuilding()};b.buildHtmlDropdown=function(){$(".links-list").each(function(){var h=$(this);h.addClass("hidden");var g=h.data("dropdown-target");var e=h.data("dropdown-label");var j=h.data("selected-item-id");var f=h.data("dropdown-option");var d="";if(g=="date-dropdown-placeholder"){d="datepicker-dropdown";h.addClass(d)}h.find('li[data-item-id="'+j+'"]').hide();h.wrap('<div class="for-dropdown" />');if(h.attr("id")=="gla-list"){h.parent().prepend('<div role="button" tabindex="0"  class="dropdown-button '+f+" dropdown-closed "+d+'"><img src="/assets/images/tfl/MoL.png" alt="Mayor of London"><span class="mol-gla">GLA</span></div>')}else{h.parent().prepend('<div tabindex="0" role="button" aria-label="'+e+'" class="dropdown-button '+f+" dropdown-closed "+d+'" >'+j+"</div>")}$("."+g).append(h.parent());if(!h.attr("id")=="gla-list"||!h.attr("id")){$(h).find("li:visible:first").css("border-top","solid 1px #cacaca")}h.siblings(".dropdown-button").click(function(){b.hideShowList(h.siblings(".dropdown-button"))}).keypress(function(k){if(k.which==13){$(this).click()}})})};b.hideShowList=function(d){if($(d).hasClass("dropdown-closed")){clearTimeout(c);c=0;a=undefined;$('ul.links-list:not(".hidden")').addClass("hidden").prev(".dropdown-button").addClass("dropdown-closed")}$(d).next("ul.links-list").toggleClass("hidden");$("ul.links-list li:visible:first").css("border-top-width","1px");$(d).toggleClass("dropdown-closed");clearTimeout(c);c=0;a=undefined};b.dropDownMouseFunctionality=function(){$(".for-dropdown").on("mouseleave",function(){var d=$(this);a=d;c=setTimeout(function(){if(!d.children(".dropdown-button").hasClass("dropdown-closed")){b.hideShowList(d.children(".dropdown-button"))}},500)}).on("mouseenter",function(){if(c&&$(this).is(a)){clearTimeout(c);c=0;a=undefined}})};b.datePickerDropdownBuilding=function(){$(".advance-month-container").parent().addClass("no-hover")};b.init()})(window.tfl.listToDropdown=window.tfl.listToDropdown||{});(function(a){tfl.logs.create("tfl.search-icon-toggle: loaded");var b=$(".search-tools input:text");var c=b.val();b.on("keyup",function(){a.toggleSearchIcon()}),$(".search-tools a.remove-content").click(function(){a.toggleSearchIcon()});a.toggleSearchIcon=function(){var d=b.val();if(d.length==0){$("#search-button").show()}else{$("#search-button").hide()}};a.h1Fix=function(){var f=$(".search-title");var d=$(".dots").length;if(d==0){f.append("<span class='hero-headline dots visually-hidden'>...</span>")}f.css("display","inline-block");var g=f.outerWidth();var e=f.parent().outerWidth();e=e*0.95;e=e-20;if(g>e){f.css("display","block");$(".dots").removeClass("visually-hidden")}else{f.css("display","inline-block");$(".dots").addClass("visually-hidden")}};a.toggleSearchIcon();a.h1Fix();$(window).on("resize",function(){a.h1Fix()})}(window.tfl.searchIcon=window.tfl.searchIcon||{}));
